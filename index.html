<!DOCTYPE html>
<html class="writer-html5" lang="en" >

<!-- Mirrored from ks0198x-4dof-robot-mechanical-arm-kit-for-arduino-diy.readthedocs.io/en/latest/KS0198X.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 24 Feb 2024 08:07:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keyestudio 4DOF Robot Arm Kit for Arduino DIY &mdash; Robot arm Kit for Arduino  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" /> 

<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "KS0198X", "programming_language": "words", "project": "ks0198x-4dof-robot-mechanical-arm-kit-for-arduino-diy", "proxied_api_host": "/_", "source_suffix": ".md", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        
        <div class="wy-side-nav-search" >
          <img  alt="Paris" style="display: block;
          margin-left: auto;
          margin-right: auto;
          width: 150px; height:150px;
          " src="_images/TLE Logo.png"/>
            <a href="index.html" class="icon icon-home"> Robot arm Kit for Arduino
          </a>
       
          
      
        </div>
       
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
             
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><strong>Keyestudio 4DOF Robot Arm Kit for Arduino DIY</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="#overview">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="#features">2. Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="#kit-list">3. Kit List</a></li>
<li class="toctree-l1"><a class="reference internal" href="#assembly-guide">4. Assembly Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="#robot-arm-projects">5. Robot Arm Projects</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-1-install-arduino-ide-and-driver">Project 1: Install Arduino IDE and Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-2-4dof-rotation-and-pin-control">Project 2: 4DOF Rotation and Pin Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-3-control-the-robot-arm-by-joysticks">Project 3: Control the Robot Arm by Joysticks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#servo-control">3.1 Servo Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-the-joystick-value">3.2 Read the Joystick Value</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dual-joystick-control">3.3 Dual-Joystick Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-memory-function">3.4 Add Memory Function</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#project-4-bt-controlled-robot-arm">Project 4: BT-controlled Robot Arm</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-5-ps2-controlled-robot-arm-extension">Project 5: PS2-controlled Robot Arm (Extension)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ps2-joypad-key-test">5.1 PS2 Joypad Key Test</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ps2-joypad-control">5.2 PS2 Joypad Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ps2-controlling-posture-memory">5.3 PS2 Controlling Posture Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ps2-controls-posture-memory-and-loop">5.4 PS2 Controls Posture Memory and Loop</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Robot arm Kit for Arduino</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">

  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="keyestudio-4dof-robot-arm-kit-for-arduino-diy">
   
<h1><strong>Keyestudio 4DOF Robot Arm Kit for Arduino DIY</strong><a class="headerlink" href="#keyestudio-4dof-robot-arm-kit-for-arduino-diy" title="Permalink to this headline"></a></h1>
<p>
  <img src="_images/bc28b720107f8f23544ad279a6530454.jpg" />
  </p>
</section>

<section id="overview">
<h1>1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h1>
<p><img alt="" src="_images/08f27f2c7d463844da60cfe6552ff2b8.jpg" /></p>
<p>DIY is the activity of making or repairing things yourself, especially in your home. Historically, it has been popular all over the world since 1960s, making our routine life interesting.Combined with STEM education, DIY products can greatly cultivate teenagers’ imagination and creativity.</p>
<p>Therefore, we Keyestudio R&amp;D group rolls out an amazing 4DOF mechanical arm kit, which contributes to improving kids’hand-on ability, logical thinking and observation ability.</p>
<p>It is easy to build to say the least. In fact, the four servos of this robot arm are controlled by V4.0 control board and two joystick modules. What’s more, the detailed tutorials are provided for you even you are a starter.</p>
<p>For this mechanical robot arm, there are three methods to control. The first one is controller handle we provide(joystick modules), the second one is App; and the third one is wireless PS2 joystick module(not included in this kit).</p>
<p>I believe that you can’t help getting down with this kit.</p>
<p>Next, let’s get started.</p>
</section>
<section id="features">
<h1>2. Features<a class="headerlink" href="#features" title="Permalink to this headline"></a></h1>
<p>You can check out these features:</p>
<ul class="simple">
<li><p>Detailed installation instructions</p></li>
<li><p>Detailed debugging methods, starting Arduino from entry.</p></li>
<li><p>Three controlling methods: Wired JoyStick Control; Phone Bluetooth Control;
Wireless PS2 JoyStick Control.</p></li>
</ul>
<p><img alt="" src="_images/765163cb54b29d1a3a02f91d301ae60c.png" /></p>
<p><strong>The parameters of keyestudio servo motor/ drive shield are as follows:</strong></p>
<ul class="simple">
<li><p>VIN voltage: VIN = DC 7-15V</p></li>
<li><p>VIN current: 5A</p></li>
<li><p>Two-channl 5V output: 5V/3A</p></li>
<li><p>PS2 interface: compatible with Sony PS2 receiver, can be plugged directly
into the expansion board.</p></li>
<li><p>Dimensions: 73*53.34mm</p></li>
</ul>
</section>
<section id="kit-list">
<h1>3. Kit List<a class="headerlink" href="#kit-list" title="Permalink to this headline"></a></h1>
<p>You can see a pretty beautiful packaging box for the arm kit, and inside the packaging you will find all the parts and screws listed below.</p>
<p>Note: Peel the plastic film off the board first when you install robotic arm.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>No.</p></th>
<th class="head"><p>Item</p></th>
<th class="head"><p>QTY</p></th>
<th class="text-center head"><p>Picture</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Keyestudio V4.0Control Board</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/fe24b8b6430a3cb22935c738973ab4e7.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Keyestudio Servo Motor Driver Shield</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/5d9af209ce35e61d45e99b94b84a785f.png" /></p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Acrylic Boards</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/901dc92d4e5649fd6d4df346ad4c88c1.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Acrylic Handle</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/4605d752050e15c93daef1d4bc79b2a2.png" /></p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>MeArm ABS Cylindrical Holder</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/016dd4292d1379a08005c1ba4e2fdfd5.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>180° Black Servo</p></td>
<td><p>4</p></td>
<td class="text-center"><p><img alt="img" src="_images/image-20230410173402962.png" /></p></td>
</tr>
<tr class="row-even"><td><p>7</p></td>
<td><p>BT-24 Module</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/cbb807206a90dfa82cf44f053ecf00a7.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>Keyestudio Joystick Module</p></td>
<td><p>2</p></td>
<td class="text-center"><p><img alt="img" src="_images/image-20230410173516397.png" /><img alt="img" src="_images/image-20230410173522011.png" /></p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>3D PS2 Joystick Cap</p></td>
<td><p>2</p></td>
<td class="text-center"><p><img alt="img" src="_images/image-20230410173531173.png" /><img alt="img" src="_images/image-20230410173531173.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>3*40MM Screwdriver</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/01bd3fbf7146416a75366c780ff94aa4.png" /></p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>Galvanized Wrench</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/a83211b6d7dd2e9618b99d2a15933d8e.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>M3*6MM Round Head Screws</p></td>
<td><p>12</p></td>
<td class="text-center"><p><img alt="img" src="_images/af100edee4ba354853d18f26cd81f336.jpg" /></p></td>
</tr>
<tr class="row-even"><td><p>13</p></td>
<td><p>M3*10MM Round Head Screws</p></td>
<td><p>22</p></td>
<td class="text-center"><p><img alt="img" src="_images/98878819babf450d1cedcabacce961a8.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>14</p></td>
<td><p>M3*14MM Flat Head Screws</p></td>
<td><p>2</p></td>
<td class="text-center"><p><img alt="img" src="_images/222edc9da7a12bc4fa55b46c03a74db4.jpg" /></p></td>
</tr>
<tr class="row-even"><td><p>15</p></td>
<td><p>M3*12MM Round Head Screws</p></td>
<td><p>12</p></td>
<td class="text-center"><p><img alt="img" src="_images/806c62895fd741049f7ef312dcb8cdd9.png" /></p></td>
</tr>
<tr class="row-odd"><td><p>16</p></td>
<td><p>M3*24+6MM Copper Pillar</p></td>
<td><p>4</p></td>
<td class="text-center"><p><img alt="img" src="_images/98250b3768a00db281252da8ebdf59cd.jpg" /></p></td>
</tr>
<tr class="row-even"><td><p>17</p></td>
<td><p>M3*6mm+6mm Copper Pillar</p></td>
<td><p>10</p></td>
<td class="text-center"><p><img alt="img" src="_images/a28ff1d02df274779c4c06ce4ad98e23.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>18</p></td>
<td><p>M3 Stainless Steel Hex Nuts</p></td>
<td><p>22</p></td>
<td class="text-center"><p><img alt="img" src="_images/54b2c7943e4c218c8f6520bca9cb1355.jpg" /></p></td>
</tr>
<tr class="row-even"><td><p>19</p></td>
<td><p>M3 Hexagon Nuts</p></td>
<td><p>24</p></td>
<td class="text-center"><p><img alt="img" src="_images/4d0cfd22998d00d5eee971fe31e8b9ac.jpg" /><img alt="img" src="_images/4d0cfd22998d00d5eee971fe31e8b9ac.jpg" /><img alt="img" src="_images/4d0cfd22998d00d5eee971fe31e8b9ac.jpg" /><img alt="img" src="_images/4d0cfd22998d00d5eee971fe31e8b9ac.jpg" /><img alt="img" src="_images/4d0cfd22998d00d5eee971fe31e8b9ac.jpg" /><img alt="img" src="_images/4d0cfd22998d00d5eee971fe31e8b9ac.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>20</p></td>
<td><p>M1.2x5MM Phillips Self-tapping Screws</p></td>
<td><p>8</p></td>
<td class="text-center"><p><img alt="img" src="_images/b3e4597717a6ef97d4b21bcbadc54cbf.jpg" /></p></td>
</tr>
<tr class="row-even"><td><p>21</p></td>
<td><p>M2x5MM Phillips Self-tapping Screws</p></td>
<td><p>10</p></td>
<td class="text-center"><p><img alt="img" src="_images/99db8cdaa063b46c600347f1eed491cc.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>22</p></td>
<td><p>M3 304 Stainless Steel Flat Washer</p></td>
<td><p>10</p></td>
<td class="text-center"><p><img alt="img" src="_images/039dd1eefcc758ea72eaf36ceda9a26c.png" /><img alt="img" src="_images/039dd1eefcc758ea72eaf36ceda9a26c.png" /><img alt="img" src="_images/039dd1eefcc758ea72eaf36ceda9a26c.png" /> <img alt="img" src="_images/039dd1eefcc758ea72eaf36ceda9a26c.png" /></p></td>
</tr>
<tr class="row-even"><td><p>23</p></td>
<td><p>M2x8MM Phillips Self-tapping Screws</p></td>
<td><p>2</p></td>
<td class="text-center"><p><img alt="img" src="_images/11485a7f791c43e4025934053499bb69.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>24</p></td>
<td><p>M3*16MM Flat Head Screws</p></td>
<td><p>2</p></td>
<td class="text-center"><p><img alt="img" src="_images/3e539248935cd6f23bdf209ab2c643f5.png" /></p></td>
</tr>
<tr class="row-even"><td><p>25</p></td>
<td><p>Male-Female 10CM Jumper Wire</p></td>
<td><p>4</p></td>
<td class="text-center"><p><img alt="img" src="_images/0587d9598c441e7811fe4e5b0003b402.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>26</p></td>
<td><p>Female- Female 50CM Jumper Wire</p></td>
<td><p>10</p></td>
<td class="text-center"><p><img alt="img" src="_images/ddcc1b551035aaa79a16f32b0dc236e2.jpg" /></p></td>
</tr>
<tr class="row-even"><td><p>27</p></td>
<td><p>Black 3*100MM Cable Ties</p></td>
<td><p>7</p></td>
<td class="text-center"><p><img alt="img" src="_images/fbcd05e6a81250043d55cc395288df57.jpg" /> <img alt="img" src="_images/fbcd05e6a81250043d55cc395288df57.jpg" /></p></td>
</tr>
<tr class="row-odd"><td><p>28</p></td>
<td><p>18650 2-Slot Battery Holder</p></td>
<td><p>1</p></td>
<td class="text-center"><p><img alt="img" src="_images/wps62.jpg" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="assembly-guide">
<h1>4. Assembly Guide<a class="headerlink" href="#assembly-guide" title="Permalink to this headline"></a></h1>
<p>(1) Install the base of the robotic arm</p>
<p>Components Needed:</p>
<p><img alt="2" src="_images/0bf750cac795344f76738358aa32552a.png" /></p>
<p><img alt="1" src="_images/2a763ec2b148deab01e7277703053126.jpg" /></p>
<p><img alt="" src="_images/b301d079dbab2c407327802bf5354b3e.jpg" /></p>
<p><img alt="" src="_images/be030e52e3a4ebf87fce3a5c4b2a3f9c.jpg" /></p>
<p><img alt="" src="_images/6ac7a0fdd99f2099898e8d5f273d3aa6.jpg" /></p>
<p><img alt="3" src="_images/b8f6ac633d25a3e4c6839ec7777d219a.jpg" /></p>
<p><img alt="" src="_images/99ebf022311c7a36775aa400d676f9a4.jpg" /></p>
<p><img alt="D" src="_images/9e3100f2ace61adc42326e7c21ee541a.png" /></p>
<p>The base is installed successfully.</p>
<p><img alt="D" src="_images/3050daf255110037ea3c448e58451efd.png" /></p>
<p>(2)  Mount servos onto the base</p>
<p>Components Needed:</p>
<p><img alt="D" src="_images/3af0bd2a054c4196c9e7dcc29aea017f.png" /></p>
<p><img alt="" src="_images/900632e9d9a1c8850cddc67a26432128.jpg" /></p>
<p><img alt="" src="_images/c13ce5468b6475bee86ae6b97664b899.jpg" /></p>
<p><img alt="D" src="_images/d8d9c72d3e594a1ee5f2765b12d618e9.png" /></p>
<p><img alt="D" src="_images/9a4243ebfd6fec8b1822ec33122b046c.png" /></p>
<p><strong>Assemble a servo(left) onto the left board</strong></p>
<p>Components Needed:</p>
<p><img alt="" src="_images/0f02b1a92dca404ed535f05faf6cddcd.jpg" /></p>
<p><img alt="" src="_images/01cd8a2ed100d19c1c87f592baaa7416.jpg" /></p>
<p><img alt="" src="_images/20c54c68432abb9cb14f4822650aedc0.jpg" /></p>
<p><strong>Initialize the left servo</strong></p>
<p>Attach this left servo to G, V and S（6）of servo motor driver shield, upload the following code, plug in power and press the rest button on the V4.0 board. Then the left servo rotates to 180°</p>
<p><img alt="" src="_images/5d9af209ce35e61d45e99b94b84a785f.png" /></p>
<p><strong>Test Code：</strong></p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Servo.h&gt;</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span><span class="w"> </span><span class="c1">// Change pin to adjust one by one</span>

<span class="n">myservo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span><span class="w"> </span><span class="c1">//Angle</span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="" src="_images/7e8e691c6517cb65d9d4dfd7e970d39a.png" /></p>
<p>a.  Fix the arm：</p>
<p><img alt="第四部分步骤2" src="_images/a304dc7093ff11f8bed6266cff854f9c.jpg" /></p>
<p><img alt="第四部分步骤2完成" src="_images/bb14a81777f263ea0def8baf7741baca.jpg" /></p>
<p><img alt="第四部分步骤3" src="_images/8097c30a4d7870e926d870de3774e633.jpg" /></p>
<p><img alt="" src="_images/3877f3db7e2b872532fdede8457d79c0.jpg" /></p>
<p><img alt="第四部分完成" src="_images/2f32a3bafd59ca9888173ce1d2fc5f45.jpg" /></p>
<p><strong>Mount a servo(right) onto the right board</strong></p>
<p>Components Needed</p>
<p><img alt="第三部分BOM" src="_images/aaa5af053bf6e99ef7e49815372d11b0.jpg" /></p>
<p><strong>Note the breach direction of acrylic board</strong></p>
<p><img alt="" src="_images/20df28879cf951685eb70efbaa299c39.png" /></p>
<p><img alt="" src="_images/aade97bd371b5346e34b8e9238e5b63c.png" /></p>
<p>b. Initialize the right servo</p>
<p>Attach this left servo to G, V and S（A0）of servo motor driver shield, upload the following code, plug in power and press the rest button on the V4.0 board. Then the left servo rotates to 0°</p>
<p><img alt="" src="_images/3056fb1107a1247e5ef1a179b6110078.png" /></p>
<p><strong>Set the servo to 0°：</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Servo.h&gt;</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Change pin to adjust one by one</span>

<span class="n">myservo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">//Angle</span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="" src="_images/3d723916f21b92ac182d571d90f14f39.png" /></p>
<p><img alt="第三部分步骤2" src="_images/1f6af19eec7c2992dbfcf2a658b31520.jpg" /></p>
<p><img alt="第三部分步骤2完成" src="_images/d6a8a4943fa2dacab6f6348741299421.jpg" /></p>
<p><img alt="第三部分步骤3" src="_images/132e4c5f2eb8aec0dd2bd18e9a6310b0.jpg" /></p>
<p><img alt="C" src="_images/c710a360e1492115523576dc82188d3a.jpg" /></p>
<p><img alt="" src="_images/0eb5f1a24de50217c4b6e23a96606d06.jpg" /></p>
<p><strong>Install the holder part</strong></p>
<p><img alt="第六部分BOM" src="_images/3bbb213eaf731a0db76a4a2e62921417.jpg" /></p>
<p><img alt="第六部分步骤1" src="_images/b7e62bb4fb6f52bb05ff4453535cdfd9.jpg" /></p>
<p><img alt="第六部分完成" src="_images/69e9234904115f4f3e7070b86d08bce2.jpg" /></p>
<p><strong>Fix the left part and the mount part together</strong></p>
<p><img alt="第七部分BOM" src="_images/82b6c7506eaede3bd5fa416788f057c9.jpg" /></p>
<p><img alt="第七部分步骤1" src="_images/d9f54ca69fd0cd0f227625f61427160c.jpg" /></p>
<p><img alt="第七部分完成" src="_images/f04494ba838013044b712690419da82d.jpg" /></p>
<p>Fix the right part and the ABS holder together.</p>
<p><img alt="IMG_256" src="_images/df653036bd9e69f2c6ac2edd995f5db8.png" /></p>
<p>Note the direction of the ABS holder.</p>
<p><img alt="KS0198 机械臂" src="_images/4bf3eeed93f71edd591afc0ec0c1704c.png" /></p>
<p><img alt="KS0198 机械臂2" src="_images/d464c5adcaa13faaf198d9dcc1a75041.png" /></p>
<p><img alt="第八部分步骤1" src="_images/3f2123f82bc2f6dfe9451b4c271cae17.jpg" /></p>
<p><img alt="第八部分步骤1完成" src="_images/41aabb58e674778a3caf8ea821c39c97.jpg" /></p>
<p><img alt="第八部分步骤2" src="_images/4bdd0811fa6c79e2d36fad2746842fb6.jpg" /></p>
<p><img alt="第八部分步骤2完成" src="_images/884934db59af95e4f137715d2c5605b5.jpg" /></p>
<p><img alt="" src="_images/285b39c2cfed3af44cdd6f9747feb308.png" /></p>
<p><img alt="第八部分步骤3完成" src="_images/2d942d035554fe994f6af4a9907b6933.jpg" /></p>
<p><img alt="第八部分步骤4" src="_images/c698971b738ab39975541107f3c1b784.jpg" /></p>
<p><img alt="第八部分完成" src="_images/270273ef0dc1555c1010941a52bca2f7.jpg" /></p>
<p><strong>Install the middle part</strong></p>
<p><img alt="第九部分BOM" src="_images/662f31769769fb9ae222ed1076b4bd06.jpg" /></p>
<p><img alt="第九部分步骤1" src="_images/9c3cdfda462814d45444e6b47521fb4b.jpg" /></p>
<p><img alt="第九部分步骤1完成" src="_images/ea186089cce431c9d56b46559ac13a6a.jpg" /></p>
<p><img alt="第九部分步骤2" src="_images/3df942d2a400c0f6ef598546285b1d73.jpg" /></p>
<p><img alt="第九部分步骤2完成" src="_images/7a795b25f5217bc0daf20d592dfc07b9.jpg" /></p>
<p><img alt="第九部分步骤4" src="_images/f06a7be7baf66e57a25a784fc342ee2e.jpg" /></p>
<p><img alt="第九部分步骤4完成" src="_images/c848923becdf9fadcbe90d4e0de24090.jpg" /></p>
<p><img alt="第九部分步骤5" src="_images/cd7c92301b426cbe23ba6c01c156c83f.jpg" /></p>
<p><img alt="第九部分步骤5完成" src="_images/7120b081f1725841b51c96036fb90b23.jpg" /></p>
<p><img alt="第九部分步骤3" src="_images/de3fefbb0d301c2633da2a72a117fe73.jpg" /></p>
<p><img alt="第九部分步骤3完成" src="_images/941d949e87148cfa6e714aa1fe5519e1.jpg" /></p>
<p><img alt="第九部分步骤6" src="_images/c3ad4304094dea28b4df36c5da3ad665.jpg" /></p>
<p><img alt="第九部分步骤7" src="_images/19e237895419cc9a8003336e4c45dd75.jpg" /></p>
<p><img alt="第九部分完成" src="_images/6929707a4af4e242b031b3c4697c9e45.jpg" /></p>
<p>Assemble the claw</p>
<p><img alt="第十二部分BOM(1)" src="_images/f3423a37186a799a22b1bf027f729a7d.jpg" /></p>
<p><img alt="第十部分步骤1" src="_images/795d2b6764d3a8373f46c1c6356d5cea.jpg" /></p>
<p><img alt="第十部分步骤2" src="_images/185ad1d1a4867ac82183fbbdb4f4105a.jpg" /></p>
<p><img alt="第十部分步骤3" src="_images/0f17947a8082167466f7fafe8ddbbc28.jpg" /></p>
<p><img alt="第十部分步骤3完成" src="_images/18f57d5abb4ec4f7c0d4b1ee9fd4a09e.jpg" /></p>
<p><img alt="第十一部分步骤1" src="_images/4339b818650c5277d0226c5733b59a6a.jpg" /></p>
<p><img alt="第十一部分步骤1完成" src="_images/2466fa9b19e3fed0943d90ff050864f7.jpg" /></p>
<p><img alt="第十一部分步骤2" src="_images/94badf1fc2d0108ee8691ec5d331266f.jpg" /></p>
<p><img alt="第十一部分完成" src="_images/0bf41e8229f69bf43363c71f652b35ad.jpg" /></p>
<p><img alt="第十二部分步骤1" src="_images/17990838d4f398c415d010393add9f79.jpg" /></p>
<p><img alt="第十二部分步骤1完成" src="_images/6490a0b67ed01d89e8cb7b98f3e3399d.jpg" /></p>
<p><img alt="第十二部分步骤2" src="_images/4c60300e0f13e6f75ab43dac927415d1.jpg" /></p>
<p><img alt="第十二部分步骤2完成" src="_images/ee9c2c1c4acf8057578e9e6333a9adce.jpg" /></p>
<p><strong>c. Initialize the servo</strong></p>
<p>Attach this left servo to G, V and S（9）of servo motor driver shield, upload the following code, plug in power and press the rest button on the V4.0 board. Then the left servo rotates to 0°</p>
<p><img alt="手机屏幕的截图中度可信度描述已自动生成" src="_images/ba2b6b8375169f6522d30b772d121ee4.png" /></p>
<p><strong>Set the servo to 0°：</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Servo.h&gt;</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span><span class="w"> </span><span class="c1">// Change pin to adjust one by one</span>

<span class="n">myservo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">//Angle</span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="" src="_images/dc79116b918705e31ce18d0a7272a995.png" /></p>
<p><strong>Mount gear wheels：</strong></p>
<p><img alt="第十二部分步骤3" src="_images/39922e6602fe3663613755fc36299bf7.jpg" /></p>
<p><img alt="第十二部分步骤3完成" src="_images/8afd3d27e7ae0ecf4538a0f897a9f69e.jpg" /></p>
<p><strong>Components Needed:</strong></p>
<p><img alt="D:交接文件KS0198KS0198-X图片0KS363_View 88.png0KS363_View88" src="_images/93cab42aabb33391880b694a18e0fde1.png" /></p>
<p><img alt="第十三部分步骤1" src="_images/0513adfceac48b0f8192bcab88d9b206.jpg" /></p>
<p><img alt="第十三部分步骤1完成" src="_images/69ee4b41d81cc23eb2789bbddb62067f.jpg" /></p>
<p><img alt="第十三部分步骤2" src="_images/e2ff6bc065dc195e452215a2395c9040.jpg" /></p>
<p><img alt="第十三部分步骤2完成" src="_images/477246043b6485b9a78838976f82ee14.jpg" /></p>
<p><strong>Initialize the servo</strong></p>
<p>Attach this left servo to G, V and S（A1）of sevro motor driver shield, upload the following code, plug in power and press the rest button on the V4.0 board. Then the left servo rotates to 80°</p>
<p><img alt="手机屏幕的截图中度可信度描述已自动生成" src="_images/ad25a59b5a9f0e490644af473a7fac4a.png" /></p>
<p><strong>Set the servo to 80°：</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Servo.h&gt;</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Change pin to adjust one by one</span>

<span class="n">myservo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span><span class="w"> </span><span class="c1">//Angle</span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><img alt="" src="_images/38566aa4430e5d3ddd737614234c0161.png" /></p>
<p><strong>Install the robotic arm：</strong></p>
<p><img alt="D:交接文件KS0198KS0198-X图片0KS363_View 96.png0KS363_View96" src="_images/f5acf0b1d847142d59f01914c645009d.png" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片0KS363_View 93.png0KS363_View93" src="_images/274f885ffc74f4f1b243207ef97457b2.png" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片0KS363_View 97.png0KS363_View97" src="_images/e1b25b18f768c0210e6d8667a1bb0267.png" /></p>
<p><strong>Mount the control part</strong></p>
<p><img alt="第十四部分BOM" src="_images/a2643cc45d809d7dad76e3afd660e206.jpg" /></p>
<p><img alt="第十四部分步骤1" src="_images/79ceff11e3d7914c2c52982bae74afd6.jpg" /></p>
<p><img alt="第十四部分步骤1完成" src="_images/3037498b970e44d4b3d012cccaabfcb0.jpg" /></p>
<p><img alt="第十四部分步骤2" src="_images/437bc5190bf4234f775c1dd9ae79fefd.jpg" /></p>
<p><img alt="第十四部分完成" src="_images/1aa09d1363a4472c0a6f97d7646cb3cc.jpg" /></p>
<p>Wiring-up Guide</p>
<p><img alt="第十五部分步骤1完成(2)" src="_images/9df3954ab59b2ff01c2a51c66d32413b.jpg" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片新建文件夹1.jpg1" src="_images/812b861eccfa6203e86f75101c273fc2.jpg" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片新建文件夹KS0198 机械臂手柄和接线_View 108.pngKS0198 机械臂 手柄和接线_View108" src="_images/48a33a51ee73d2c3b4bdfa001738e1f0.png" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片新建文件夹第十五部分步骤3.jpg第十五部分步骤3" src="_images/8cbe2c5b96b1590d3c628834d2254886.jpg" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片新建文件夹KS0198 机械臂手柄和接线_View 110.pngKS0198 机械臂 手柄和接线_View110" src="_images/e5fc99eae42c5882a675c5f2632b13ff.png" /></p>
<p><img alt="D:交接文件KS0198KS0198-X图片新建文件夹KS0198 机械臂手柄和接线_View 111.pngKS0198 机械臂 手柄和接线_View111" src="_images/5be4063110abcdc75e79f2bd91ae46b2.png" /></p>
<p><strong><img alt="D:交接文件KS0198KS0198-X图片新建文件夹0KS363_View112.png0KS363_View 112" src="_images/9e226839e324f6181548ba533ff8e922.png" /></strong></p>
</section>
<section id="robot-arm-projects">
<h1>5. Robot Arm Projects<a class="headerlink" href="#robot-arm-projects" title="Permalink to this headline"></a></h1>
<section id="project-1-install-arduino-ide-and-driver">
<h2>Project 1: Install Arduino IDE and Driver<a class="headerlink" href="#project-1-install-arduino-ide-and-driver" title="Permalink to this headline"></a></h2>
<p><strong>Keyestudio V4.0 Development Board</strong></p>
<p><img alt="" src="_images/fe24b8b6430a3cb22935c738973ab4e7.png" /></p>
<p>Keyestudio V4.0 development board is an Arduino uno-compatible board, which is based on ATmega328P MCU, and with a cp2102 Chip as a UART-to-USB converter.</p>
<p><img alt="KS0497标注图2_画板 1" src="_images/e4add7160d77a0ee750ba7f0cc352334.jpg" /></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>1</p></th>
<th class="head"><p><strong>ICSP (In-Circuit Serial Programming) Header</strong></p></th>
<th class="head"><p>the AVR, an Arduino micro-program header consisting of MOSI, MISO, SCK, RESET, VCC, and GND. It is often called the SPI (serial peripheral interface) and can be considered an “extension” of the output. In fact, slave the output devices to the SPI bus host. When connecting to PC, program the firmware to ATMEGA328P-PU.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><p><strong>Power LED Indicator</strong></p></td>
<td><p>Powering the Arduino, LED on means that your circuit board is correctly powered on. If LED is off, connection is wrong.</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p><strong>Digital I/O</strong></p></td>
<td><p>Arduino MEGA has 14 digital input/output pins (of which 6 can be used as PWM outputs).These pins can be configured as digital input pin to read the logic value (0 or 1). Or used as digital output pin to drive different modules like LED, relay, etc. Using <a class="reference external" href="https://www.arduino.cc/reference/en/language/functions/digital-io/pinmode/">pinMode()</a>, <a class="reference external" href="https://www.arduino.cc/reference/en/language/functions/digital-io/digitalwrite/">digitalWrite()</a>, and <a class="reference external" href="https://www.arduino.cc/reference/en/language/functions/digital-io/digitalread/">digitalRead()</a> functions.</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p><strong>GND</strong></p></td>
<td><p>GND</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p><strong>AREF</strong></p></td>
<td><p>Reference voltage (0-5V) for analog inputs. Used with <a class="reference external" href="https://www.arduino.cc/reference/en/language/functions/analog-io/analogreference/">analogReference()</a>. Configures the reference voltage used for analog input (i.e. the value used as the top of the input range).</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p><strong>SDA</strong></p></td>
<td><p>IIC communication pin</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p><strong>SCL</strong></p></td>
<td><p>IIC communication pin</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p><strong>RESET Button</strong></p></td>
<td><p>You can reset your Arduino board,</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p><strong>D13 LED</strong></p></td>
<td><p>There is a built-in LED driven by digital pin 13. When the pin is HIGH value, the LED is on, when the pin is LOW, it’s off.</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p><strong>USB Connection</strong></p></td>
<td><p>Arduino board can be powered via USB connector. All you needed to do is connecting the USB port to PC using a USB cable.</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p><strong>CP2102</strong></p></td>
<td><p>USB serial chip, translate the USB signal of computer into serial signal</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p><strong>TX LED</strong></p></td>
<td><p>Onboard you can find the label: TX (transmit) When Arduino board communicates via serial port, send the message, TX led flashes.</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p><strong>RX LED</strong></p></td>
<td><p>Onboard you can find the label: RX(receive ) When Arduino board communicates via serial port, receive the message, RX led flashes.</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p><strong>Crystal Oscillator</strong></p></td>
<td><p>How does Arduino calculate time? by using a crystal oscillator. The number printed on the top of the Arduino crystal is 16.000H9H. It tells us that the frequency is 16,000,000 Hertz or 16MHz.</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p><strong>Voltage Regulator</strong></p></td>
<td><p>To control the voltage provided to the Arduino board, as well as to stabilize the DC voltage used by the processor and other components. Convert an external input DC7-12V voltage into DC 5V, then switch DC 5V to the processor and other components.</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p><strong>DC Power Jack</strong></p></td>
<td><p>Arduino board can be supplied with an external power DC7-12V from the DC power jack.</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p><strong>Microcontroller</strong></p></td>
<td><p>Each Arduino board has its own microcontroller. You can regard it as the brain of your board. The main IC (integrated circuit) on the Arduino is slightly different from the panel pair. Microcontrollers are usually from ATMEL. Before you load a new program on the Arduino IDE, you must know what IC is on your board. This information can be checked at the top of IC.</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p><strong>IOREF</strong></p></td>
<td><p>This pin on the board provides the voltage reference with which the microcontroller operates. A properly configured shield can read the IOREF pin voltage and select the appropriate power source or enable voltage translators on the outputs for working with the 5V or 3.3V.</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p><strong>RESET Header</strong></p></td>
<td><p>Connect an external button to reset the board. The function is the same as reset button.</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p><strong>Power Pin 3V3</strong></p></td>
<td><p>A 3.3 volt supply generated by the on-board regulator. Maximum current draw is 50 mA.</p></td>
</tr>
<tr class="row-odd"><td><p>21</p></td>
<td><p><strong>Power Pin 5V</strong></p></td>
<td><p>Provides 5V output voltage</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p><strong>Vin</strong></p></td>
<td><p>You can supply an external power input DC7-12V through this pin to Arduino board.</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p><strong>Analog Pins</strong></p></td>
<td><p>Onboard has 6 analog inputs, labeled A0 to A5.</p></td>
</tr>
</tbody>
</table>
<p><strong>Installing Arduino IDE</strong></p>
<p><img alt="" src="_images/ide.png" /></p>
<p><strong>Click the link to start learning how to download software, install drivers, upload code, and install library files.</strong></p>
<p><strong><a class="reference external" href="https://getting-started-with-arduino.readthedocs.io/en/latest/Arduino IDE Tutorial.html">https://getting-started-with-arduino.readthedocs.io</a></strong></p>
</section>
<section id="project-2-4dof-rotation-and-pin-control">
<h2>Project 2: 4DOF Rotation and Pin Control<a class="headerlink" href="#project-2-4dof-rotation-and-pin-control" title="Permalink to this headline"></a></h2>
<p><strong>（1）Joint Rotation and Servo Angle Settings</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>0°</strong></p></th>
<th class="head"><p><strong>180°</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Servo 1（baseplate）</p></td>
<td><p>Rotate toward the rightmost</p></td>
<td><p>Rotate toward the leftmost</p></td>
</tr>
<tr class="row-odd"><td><p>Servo 2 （right side）</p></td>
<td><p>Rocker arm connected to Servo 2 draws back</p></td>
<td><p>stretch out</p></td>
</tr>
<tr class="row-even"><td><p>Servo 3 （left side）</p></td>
<td><p>Rocker arm connected to Servo 3 stretches out</p></td>
<td><p>draw back</p></td>
</tr>
<tr class="row-odd"><td><p>Servo 4 (clamp claw)</p></td>
<td><p>close</p></td>
<td><p>open</p></td>
</tr>
</tbody>
</table>
<p><strong>（2）Pin Control</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>IO Pin</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Servo 1 (baseplate)</p></td>
<td><p>A1</p></td>
</tr>
<tr class="row-odd"><td><p>Servo 2 (right side)</p></td>
<td><p>A0</p></td>
</tr>
<tr class="row-even"><td><p>Servo 3 (left side)</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>Servo 4 (clamp claw)</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>Right Joystick X</p></td>
<td><p>A2</p></td>
</tr>
<tr class="row-odd"><td><p>Right Joystick Y</p></td>
<td><p>A5</p></td>
</tr>
<tr class="row-even"><td><p>Right Joystick Z (B)</p></td>
<td><p>7</p></td>
</tr>
<tr class="row-odd"><td><p>Left Joystick X</p></td>
<td><p>A3</p></td>
</tr>
<tr class="row-even"><td><p>Left Joystick Y</p></td>
<td><p>A4</p></td>
</tr>
<tr class="row-odd"><td><p>Left Joystick Z(B)</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>D1/DAT of PS2</p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>D0/CMD of PS2</p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>CE/SEL of PS2</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>CLK of PS2</p></td>
<td><p>13</p></td>
</tr>
</tbody>
</table>
</section>
<section id="project-3-control-the-robot-arm-by-joysticks">
<h2>Project 3: Control the Robot Arm by Joysticks<a class="headerlink" href="#project-3-control-the-robot-arm-by-joysticks" title="Permalink to this headline"></a></h2>
<section id="servo-control">
<h3>3.1 Servo Control<a class="headerlink" href="#servo-control" title="Permalink to this headline"></a></h3>
<p><strong>Description</strong></p>
<p>In the previous projects, we set the square wave and angles of servos.</p>
<p>Now, we use libraries of servos to control the angle of a servo. We only need to put the servo folder in the libraries folder where the Arduino IDE location is installed, then open the Arduino IDE, the library file will take effect.</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="" src="_images/77aa1080ce7b11f7e1fb90c99a33cf60.png" /></p>
<p><strong>Test Code 1:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="cp">#include</span><span class="w">  </span><span class="cpf">&lt;Servo.h &gt;</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"> </span><span class="c1">// modify each pin to adjust</span>

<span class="n">myservo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// angle value</span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Stack the drive shield onto V4.0 board and connect the servo motor, upload the code, plug in power and press the reset button. Then the servo will automatically rotate to 0°.</p>
<p><strong>Automatic Movement</strong></p>
<p><strong>Description:</strong></p>
<p>In the previous section, you have learned to set the servo angle. In fact, we just need to continually change angles of 4 servo, thus make the 4DOF robot arm operate different motions.</p>
<p><strong>Hookup Guide:</strong></p>
<p><strong><img alt="" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></strong></p>
<p><strong>Test Code 2:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="cp">#include</span><span class="w">  </span><span class="cpf">&lt;Servo.h &gt;</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo1</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo2</span><span class="p">;</span><span class="w"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo3</span><span class="p">;</span><span class="w"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo4</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">pos1</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">pos2</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="n">pos3</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">pos4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span><span class="w"> </span><span class="c1">// attaches the servo on pin 9 to the servo object</span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="c1">// turn right</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos1</span><span class="p">;</span><span class="n">pos1</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">pos1</span><span class="o">--</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// delay 5ms（used to adjust the servo speed）</span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// open the claw</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos4</span><span class="p">;</span><span class="n">pos4</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">pos4</span><span class="o">++</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// right servo rotates to 100 degrees</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos2</span><span class="p">;</span><span class="n">pos2</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">50</span><span class="p">;</span><span class="n">pos2</span><span class="o">--</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">// left servo rotates to 5 degrees</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos3</span><span class="p">;</span><span class="n">pos3</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">50</span><span class="p">;</span><span class="n">pos3</span><span class="o">--</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span><span class="w"></span>

<span class="c1">// close the claw</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos4</span><span class="p">;</span><span class="n">pos4</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">pos4</span><span class="o">--</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// left servo rotates to100 degrees, rocker arm lifts.</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos3</span><span class="p">;</span><span class="n">pos3</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">120</span><span class="p">;</span><span class="n">pos3</span><span class="o">++</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// turn to left</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos1</span><span class="p">;</span><span class="n">pos1</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">180</span><span class="p">;</span><span class="n">pos1</span><span class="o">++</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// Lower the arm</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos3</span><span class="p">;</span><span class="n">pos3</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">50</span><span class="p">;</span><span class="n">pos3</span><span class="o">--</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// open the claw</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos4</span><span class="p">;</span><span class="n">pos4</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="n">pos4</span><span class="o">++</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// lift up the arm</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos3</span><span class="p">;</span><span class="n">pos3</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">120</span><span class="p">;</span><span class="n">pos3</span><span class="o">++</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="c1">// close the claw</span>

<span class="k">for</span><span class="p">(</span><span class="n">pos4</span><span class="p">;</span><span class="n">pos4</span><span class="w"> </span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">pos4</span><span class="o">--</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Stack the driver shield onto V4.0 board and connect the servo motor, upload well the code., plug in power and press the reset button. Then the robot arm will rotate to right, stretch out the arm, lower and enable claw; then it will withdraw, lift, rotate to left, stretch out, lower and make claw open.</p>
<p>This series of actions will be continuous.</p>
</section>
<section id="read-the-joystick-value">
<h3>3.2 Read the Joystick Value<a class="headerlink" href="#read-the-joystick-value" title="Permalink to this headline"></a></h3>
<p><strong>Description:</strong></p>
<p>The sensor’s pin X, Y are for analog sensor, so directly read the measured analog value. Pin Z is a digital button, first should set the pin to Input status and then read the measured value 1 (pressed down) or 0 (not press). Check out the value printed on the serial monitor.</p>
<p><strong>Connection Diagram:</strong></p>
<p><strong><img alt="" src="_images/276c6ebb45ee99fc3325c6c6d2b0df75.png" /></strong></p>
<p><strong>Test Code 3:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">right_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A2</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the right X pin to A2</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">right_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A5</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the right Y pin to A5</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">right_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="c1">//define the right key pin to 7（that is the value Z）</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A3</span><span class="p">;</span><span class="w"> </span><span class="c1">//define the left X pin to A3</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A4</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the left Y pin to A4</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c1">//define the left key pin to 8（that is the value Z）</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pinMode</span><span class="p">(</span><span class="n">right_key</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the right/left key to INPUT</span>

<span class="n">pinMode</span><span class="p">(</span><span class="n">left_key</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the baud rate to 9600</span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the variable, used to save the joystick value it reads</span>

<span class="kt">int</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">;</span><span class="w"></span>

<span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">right_X</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the value of right X</span>

<span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">right_Y</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the value of right Y</span>

<span class="n">z1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digitalRead</span><span class="p">(</span><span class="n">right_key</span><span class="p">);</span><span class="w"> </span><span class="c1">//// read the value of right Z</span>

<span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">left_X</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the value of left X</span>

<span class="n">y2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">left_Y</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the value of left Y</span>

<span class="n">z2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digitalRead</span><span class="p">(</span><span class="n">left_key</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the value of left Z</span>

<span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;right_X = &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// on the serial monitor, print out right_X =</span>

<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span><span class="w"> </span><span class="c1">// print out the value of right X and line wrap</span>

<span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;right_Y = &quot;</span><span class="p">);</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span><span class="w"></span>

<span class="c1">//Serial.print(&quot;right_key = &quot;);</span>

<span class="c1">//Serial.println(z1 ,DEC);</span>

<span class="c1">// Serial.println(&quot;**********right**********&quot;);</span>

<span class="cm">/*Serial.print(&quot;left_X = &quot;);</span>

<span class="cm">Serial.println(x2 ,DEC);</span>

<span class="cm">Serial.print(&quot;left_Y = &quot;);</span>

<span class="cm">Serial.println(y2 ,DEC);</span>

<span class="cm">Serial.print(&quot;left_key = &quot;);</span>

<span class="cm">Serial.println(z2 ,DEC);</span>

<span class="cm">Serial.println(&quot;*********left***********&quot;);*/</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Hook it up and upload well the code. Connect the V4.0 to computer using a USB cable, then open the serial monitor and set the baud rate to 9600, you should see the analog value of the right Joystick pin X,Y.</p>
<p><img alt="" src="_images/e273a05a068c806e92f9e25035586b10.png" /></p>
</section>
<section id="dual-joystick-control">
<h3>3.3 Dual-Joystick Control<a class="headerlink" href="#dual-joystick-control" title="Permalink to this headline"></a></h3>
<p><strong>Description:</strong></p>
<p>In the previous section, we have introduced how to use 4 Servo to control the robot arm. Next, combine those two experiments. Use two Joystick modules to control 4DOF robot arm realize different motions.</p>
<p>At first, set the boot posture. The Joystick control is shown as below table.</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Right Joystick</strong></p></th>
<th class="head"><p><strong>Servo</strong></p></th>
<th class="head"><p><strong>Left Joystick</strong></p></th>
<th class="head"><p><strong>Servo</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>X1  &lt;50</p></td>
<td><p>Servo 1 gradually reduces to 0° (push the right joystick to the right, the servo that controls the arm rotation turns right, and stops at 0° )</p></td>
<td><p>X2  &lt;50</p></td>
<td><p>Servo 4 gradually reduces to 0° (push the left joystick to the right, the claw is closed)</p></td>
</tr>
<tr class="row-odd"><td><p>X1  &gt;1000</p></td>
<td><p>Servo 1 gradually increases to 180° (push the right joystick to the left, the servo that controls the arm rotation turns left, and stops at 180° )</p></td>
<td><p>X2  &gt;1000</p></td>
<td><p>Servo 4 gradually increases to 180° (push the left joystick to the left, the claw opens)</p></td>
</tr>
<tr class="row-even"><td><p>Y1  &gt;1000</p></td>
<td><p>Servo 2 gradually reduces to 0° ( that is, lift up the robot upper arm)</p></td>
<td><p>Y2  &gt;1000</p></td>
<td><p>Servo 3 gradually reduces to 35° ( that is, stretch out the robot lower arm)</p></td>
</tr>
<tr class="row-odd"><td><p>Y1  &lt;50</p></td>
<td><p>Servo 2 gradually reduces to 180° ( that is, lower the robot upper arm)</p></td>
<td><p>Y2  &lt;50</p></td>
<td><p>Servo 3 gradually increases to 180° ( that is, draw back the robot lower arm)</p></td>
</tr>
</tbody>
</table>
<p><strong>Hookup Guide:</strong></p>
<p><img alt="电子游戏的截图描述已自动生成" src="_images/276c6ebb45ee99fc3325c6c6d2b0df75.png" /><img alt="图示, 示意图描述已自动生成" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code 4:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  #include   &lt;Servo.h  &gt; // add the servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo
angle,and assign the initial value (that is the boot posture angle value)

const int right_X = A2; // define the right X pin to A2

const int right_Y = A5; // define the right Y pin to A5

const int right_key = 7; // define the right key pin to 7（that is the value of
Z）

const int left_X = A3; // define the left X pin to A3

const int left_Y = A4; // define the left X pin to A4

const int left_key = 8; //define the left key pin to 8（that is the value of Z）

int x1,y1,z1; // define the variable, used to save the joystick value it read.

int x2,y2,z2;

void setup()

{

// boot posture

myservo1.write(pos1);

delay(1000);

myservo2.write(pos2);

myservo3.write(pos3);

myservo4.write(pos4);

delay(1500);

pinMode(right_key, INPUT); // set the right/left key to INPUT

pinMode(left_key, INPUT);

Serial.begin(9600); // set the baud rate to 9600

}

void loop()

{

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); // set the control pin of servo 2 to A0

myservo3.attach(6); //set the control pin of servo 3 to D6

myservo4.attach(9); // set the control pin of servo 4 to D9

x1 = analogRead(right_X); //read the right X value

y1 = analogRead(right_Y); // read the right Y value

z1 = digitalRead(right_key); //// read the right Z value

x2 = analogRead(left_X); //read the left X value

y2 = analogRead(left_Y); //read the left Y value

z2 = digitalRead(left_key); // read the left Z value

//delay(5); // lower the speed overall

// claw

zhuazi();

// rotate

zhuandong();

// upper arm

xiaobi();

//lower arm

dabi();

}

//claw

void zhuazi()

{

//claw

if(x2  &lt;50) // if push the left joystick to the right

{

pos4=pos4-2; //current angle of servo 4 subtracts 2（change the value you
subtract, thus change the closed speed of claw）

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the action, claw is gradually closed.

delay(5);

if(pos4  &lt;2) // if pos4 value subtracts to 2, the claw in 37 degrees we have
tested is closed.

{ //（should change the value based on the fact）

pos4=2; // stop subtraction when reduce to 2

}

}

if(x2  &gt;1000) //// if push the left joystick to the left

{

pos4=pos4+8; // current angle of servo 4 plus 8（change the value you plus, thus
change the open speed of claw）

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the motion, the claw gradually opens.

delay(5);

if(pos4  &gt;108) // limit the largest angle when open the claw

{

pos4=108;

}

}

}

//*********************************  *  *  *******************

// turn

void zhuandong()

{

if(x1  &lt;50) // if push the right joystick to the right

{

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 operates the motion, the arm turns right.

delay(5);

if(pos1  &lt;1) // limit the angle when turn right

{

pos1=1;

}

}

if(x1  &gt;1000) // if push the right joystick to the let

{

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); // arm turns left

delay(5);

if(pos1  &gt;180) // limit the angle when turn left

{

pos1=180;

}

}

}

//  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  **/

//upper arm

void xiaobi()

{

if(y1&gt;1000) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the upper arm will lift

delay(5);

if(pos2  &lt;0) // limit the lifting angle

{

pos2=0;

}

}

if(y1  &lt;50) // if push the right joystick downward

{

pos2=pos2+1;

myservo2.write(pos2); // upper arm will go down

delay(5);

if(pos2  &gt;180) // limit the angle when go down

{

pos2=180;

}

}

}


// lower arm

void dabi()

{

if(y2&lt;50) // if push the left joystick upward

{

pos3=pos3+1;

myservo3.write(pos3); // lower arm will stretch out

delay(5);

if(pos3  &gt;180) // limit the stretched angle

{

pos3=180;

}

}

if(y2  &gt;1000) // if push the left joystick downward

{

pos3=pos3-1;

myservo3.write(pos3); // lower arm will draw back

delay(5);

if(pos3  &lt;35) // limit the retracted angle

{

pos3=35;

}

}

}
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Upload the code to main board and stack the shield onto it and wire them up, then 4DOF robot arm will keep the initial position. You can control the robot arm with Joysticks</p>
</section>
<section id="add-memory-function">
<h3>3.4 Add Memory Function<a class="headerlink" href="#add-memory-function" title="Permalink to this headline"></a></h3>
<p><strong>Memorize One Posture</strong></p>
<p><strong>Description:</strong></p>
<p>In the previous section, use the analog value of pin X,Y of 2 Joystick modules to control the robot arm.</p>
<p>In the following experiment, we add a memory function for the robot arm, making it remember a posture then operate. Set 4 variables for saving the angle value of 4 servos, use the Joystick to control a posture. Press the key Z1 of right Joystick to save the angle value of 4 servos; press the key Z2 of left Joystick to make the servo operate a posture saved in the variable.</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="" src="_images/276c6ebb45ee99fc3325c6c6d2b0df75.png" /><img alt="" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code 5:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>  #include   &lt;Servo.h  &gt; // add servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo angle
and assign the initial value( that is the boot posture angle value)

const int right_X = A2; // define the right X pin to A2

const int right_Y = A5; // define the right Y pin to A3

const int right_key = 7; // define the right key pin to 7（that is Z value）

const int left_X = A3; // define the left X pin to A3

const int left_Y = A4; // define the left Y pin to A4

const int left_key = 8; // define the left key pin to 8（that is Z value）

int x1,y1,z1; // define the variable, used to save the joystick value.

int x2,y2,z2;

int s1,s2,s3,s4;

void setup()

{

// boot posture

myservo1.write(pos1);

delay(1000);

myservo2.write(pos2);

myservo3.write(pos3);

myservo4.write(pos4);

delay(1500);

pinMode(right_key, INPUT); // set the right/left key to INPUT

pinMode(left_key, INPUT);

Serial.begin(9600); // set the baud rate to 9600

}

void loop()

{

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); // set the control pin of servo 2 to A0

myservo3.attach(6); //set the control pin of servo 3 to D6

myservo4.attach(9); //set the control pin of servo 4 to D9

x1 = analogRead(right_X); // read the right X value

y1 = analogRead(right_Y); // read the right Y value

z1 = digitalRead(right_key); //// read the right key Z value

x2 = analogRead(left_X); // read the left X value

y2 = analogRead(left_Y); //read the left Y value

z2 = digitalRead(left_key); //read the left key Z value

//delay(5); // reduce the speed overall

if(z1==1) // if the right joystick key is pressed

{

delay(10); // delay for eliminating shake

if(z1==1) // judge again if the right key is pressed

{

s1=myservo1.read(); // read the angle value of each servo

s2=myservo2.read();

s3=myservo3.read();

s4=myservo4.read();

}

}

if(z2==1) // if the left key is pressed

{

delay(10);

if(z2==1)

{

pos1=myservo1.read(); // record the angle value of 4 servos in current posture

pos2=myservo2.read();

pos3=myservo3.read();

pos4=myservo4.read();

if(pos1  &lt;s1) // if angle of servo 1 is smaller than variable s1 value

{

while(pos1  &lt;s1) //while loop，rotate the servo to the position of the value
stored in the array.

{

myservo1.write(pos1); // servo 1 operates the motion

pos1++; //pos1 plus 1

delay(5); // delay for 5ms，controlling the rotation speed of servo.

}

}

else // if angle of servo 1 is greater than the value stored in array 1.

{

while(pos1  &gt;s1) //while loop,rotate the servo to the position of the value
stored in the array.

{

myservo1.write(pos1); // servo 1 operates the motion

pos1--; //pos1 subtracts 1

delay(5); // delay for 5ms，controlling the rotation speed of servo.

}

}


// the explanation is the same as servo 1

if(pos2&lt;s2)

{

while(pos2&lt;s2)

{

myservo2.write(pos2);

pos2++;

delay(5);

}

}

else

{

while(pos2&gt;s2)

{

myservo2.write(pos2);

pos2--;

delay(5);

}

}

//*************************************************

// the explanation is the same as servo 1

if(pos3&lt;s3)

{

while(pos3&lt;s3)

{

myservo3.write(pos3);

pos3++;

delay(5);

}

}

else

{

while(pos3&gt;s3)

{

myservo3.write(pos3);

pos3--;

delay(5);

}

}

//*************************************************

// the explanation is the same as servo 1

if(pos4&lt;s4)

{

while(pos4&lt;s4)

{

myservo4.write(pos4);

pos4++;

delay(5);

}

}

else

{

while(pos4&gt;s4)

{

myservo4.write(pos4);

pos4--;

delay(5);

}

}

}

}

//claw

zhuazi();

//turn

zhuandong();

// upper arm

xiaobi();

// lower arm

dabi();

}

//claw

void zhuazi()

{

//claw

if(x2  &lt;50) // if push the left joystick to the right

{

pos4=pos4-2; // current angle of servo 4 subtracts 2（change the value you
subtract, thus change the closed speed of claw）

//Serial.println(pos4);

myservo4.write(pos4); //servo 4 operates the action, claw is gradually closed

delay(5);

if(pos4  &lt;2) // if pos4 value subtracts to 2, the claw in 37 degrees we have
tested is closed.）

{ //（should change the value based on the fact）

pos4=2; // stop subtraction when reduce to 2

}

}

if(x2  &gt;1000) //// if push the left joystick to the left

{

pos4=pos4+8; // current angle of servo 4 plus 8（change the value you plus, thus
change the open speed of claw）

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the motion, the claw gradually opens.

delay(5);

if(pos4  &gt;90) // limit the largest angle when open

{

pos4=90;

}

}

}

//  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *

// turn

void zhuandong()

{

if(x1  &lt;50) // if push the right joystick to the right

{

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 operates the motion, the arm turns right.

delay(5);

if(pos1  &lt;1) // limit the angle when turn right

{

pos1=1;

}

}

if(x1  &gt;1000) // if push the right joystick to the left

{

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); // robot arm turns left

delay(5);

if(pos1  &gt;180) // limit the angle when turn left

{

pos1=180;

}

}

}

//  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  */

// upper arm

void xiaobi()

{

if(y1  &gt;1000) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the upper arm will lift

delay(5);

if(pos2  &lt;0) // limit the lifting angle

{

pos2=0;

}

}

if(y1  &lt;50) // if push the right joystick downward

{

pos2=pos2+1;

myservo2.write(pos2); // the upper arm will go down

delay(5);

if(pos2  &gt;180) // limit the angle when go down

{

pos2=180;

}

}

}

//  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *****************************************/

// lower arm

void dabi()

{

if(y2&gt;1000) // if push the left joystick upward

{

pos3=pos3-1;

myservo3.write(pos3); // the lower arm will stretch out

delay(5);

if(pos3&lt;35) // limit the stretched angle

{

pos3=35;

}

}

if(y2&lt;50) // if push the left joystick downward

{

pos3=pos3+1;

myservo3.write(pos3); // the lower arm will draw back

delay(5);

if(pos3&gt;180) // limit the retracted angle

{

pos3=180;

}

}

}
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Stack the shield onto V4.0, wire them up, upload the code, plug in power and press the key Z1 of right Joystick to save the angle value of 4 servos control and press the key Z2 of left Joystick to operate a servo posture saved in the variable.</p>
<p><strong>Memorize Multiple Postures</strong></p>
<p><strong>Description:</strong></p>
<p>In the previous section, we have set the angle of 4 servos to make the robot arm remember and operate a posture. To extend the experiment, next make it remember several postures, at most 10 (you can set it in the code), then make 4DOF robot arm continually operate the posture in memory. That is, make robot arm memorize a group of actions, and you can set the memorizing speed in the code.</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="" src="_images/276c6ebb45ee99fc3325c6c6d2b0df75.png" /></p>
<p><img alt="" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code 6:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>#include &lt;Servo.h&gt; // add the servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo angle
and assign the initial value( that is the boot posture angle value)

const int right_X = A2; // define the right X pin to A2

const int right_Y = A5; // define the right Y pin to A5

const int right_key = 7; // define the right key pin to 7（that is Z value）

const int left_X = A3; // define the left X pin to A3

const int left_Y = A4; // define the left Y pin to A4

const int left_key = 8; // define the left key pin to 8（that is Z value）

int x1,y1,z1; //define the variable, used to save the joystick value.

int x2,y2,z2;

int s1,s2,s3,s4;

int jiyi1[10]; // define 4 array, separately used to save the angle of four
servo.

int jiyi2[10]; //（array length is 10，namely can save angle data of 0~10 servo
）

int jiyi3[10]; // if need to save more data, just change the number 10 to be
more larger number.

int jiyi4[10];

int i=0; // for loop

int j=0; // save the last value of i

void setup()

{

// boot posture

myservo1.write(pos1);

delay(1000);

myservo2.write(pos2);

myservo3.write(pos3);

myservo4.write(pos4);

delay(1500);

pinMode(right_key, INPUT); // set the right/left key to INPUT

pinMode(left_key, INPUT);

Serial.begin(9600); // set baud rate to 9600

}

void loop()

{

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); // set the control pin of servo 2 to A0

myservo3.attach(6); // set the control pin of servo 3 to D6

myservo4.attach(9); // set the control pin of servo 4 to D9

x1 = analogRead(right_X); // read the right X value

y1 = analogRead(right_Y); // read the right Y value

z1 = digitalRead(right_key); // read the right Z value

x2 = analogRead(left_X); // read the left X value

y2 = analogRead(left_Y); // read the left Y value

z2 = digitalRead(left_key); // read the left Z value

//delay(5); // reduce the speed overall

if(z1==1) // if the right joystick key is pressed

{

delay(10); // delay for eliminating shake

if(z1==1) // judge again if the right key is pressed

{

s1=myservo1.read(); // read the angle value of each servo

delay(100);

Serial.println(s1);

s2=myservo2.read();

delay(100);

Serial.println(s2);

s3=myservo3.read();

delay(100);

Serial.println(s3);

s4=myservo4.read();

delay(100);

Serial.println(s4);

jiyi1[i]=s1; // Save the read servo value to the array sequentially

jiyi2[i]=s2;

jiyi3[i]=s3;

jiyi4[i]=s4;

i++; //i value plus 1

j=i; // assign the last value of i to j

delay(100);

Serial.println(i); // on the serial monitor, print out the value i

}

}

if(z2==1) // if the left joystick key is pressed

{

delay(10);

if(z2==1) // judge again if the left key is pressed

{

i=0; // assign i to 0，prepare for the next memory

pos1 = myservo1.read(); // memorize the angle value of 4 servo posture

pos2 = myservo2.read();

pos3 = myservo3.read();

pos4 = myservo4.read();

for(int k=0;k&lt;j;k++) // loop for j times, perform all actions saved.

{

if(pos1&lt;jiyi1[k]) // if the current servo 1 angle is less than the value stored
in array 1.

{

while(pos1&lt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); // servo 1 performs the action

delay(5); // delay 5ms，controlling the servo rotating speed

pos1++; //pos1 plus 1

//Serial.println(pos1);

}

}

else // if the current servo 1 angle is greater than the value stored in array
1.

{

while(pos1&gt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); // servo 1 performs the action

delay(5); //delay 5ms，controlling the servo rotating speed

pos1--; //pos1 subtracts 1

//Serial.println(pos1);

}

}

//***************************************************************

//the explanation is the same as the previous servo

if(pos2&lt;jiyi2[k])

{

while(pos2&lt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2++;

//Serial.println(pos1);

}

}

else

{

while(pos2&gt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2--;

//Serial.println(pos1);

}

}

//***************************************************************

// the explanation is the same as the previous servo

if(pos3&lt;jiyi3[k])

{

while(pos3&lt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3++;

//Serial.println(pos1);

}

}

else

{

while(pos3&gt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3--;

//Serial.println(pos1);

}

}

//***************************************************************

//the explanation is the same as the previous servo

if(pos4&lt;jiyi4[k])

{

while(pos4&lt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4++;

//Serial.println(pos1);

}

}

else

{

while(pos4&gt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4--;

//Serial.println(pos1);

}

}

}

}

}

//claw

zhuazi();

//turn

zhuandong();

//upper arm

xiaobi();

// lower arm

dabi();

}

//claw

void zhuazi()

{

//claw

if(x2&lt;50) // if push the left joystick to the right

{

pos4=pos4-2; // angle of servo 4, subtract 2 (change the value you subtract,
thus change the closed speed of claw)

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the motion and claw is gradually
closed.

delay(5);

if(pos4&lt;2) // if pos4 value subtracts to 2, the claw in 37 degrees we have
tested is closed.）

{ //（should change the value based on the fact）

pos4=2; // stop subtraction when reduce to 2

}

}

if(x2&gt;1000) //// if push the left joystick to the left

{

pos4=pos4+8; // current angle of servo 4 plus 8（change the value you plus, thus
change the open speed of claw）

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the action, claw gradually opens.

delay(5);

if(pos4&gt;90) // limit the largest angle opened

{

pos4=90;

}

}

}

//******************************************************

// turn

void zhuandong()

{

if(x1&lt;50) // if push the right joystick to the right

{

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 operates the motion and robot arm turns right

delay(5);

if(pos1&lt;1) // limit the angle when turn right

{

pos1=1;

}

}

if(x1&gt;1000) // if push the right joystick to the left

{

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); // robot arm turns left

delay(5);

if(pos1&gt;180) // limit the angle when turn left

{

pos1=180;

}

}

}

//**********************************************************/

// upper arm

void xiaobi()

{

if(y1&gt;1000) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the upper arm will lift

delay(5);

if(pos2&lt;0) // limit the lifting angle

{

pos2=0;

}

}

if(y1&lt;50) // if push the right joystick downward

{

pos2=pos2+1;

myservo2.write(pos2); // the upper arm will go down

delay(5);

if(pos2&gt;180) // limit the declining angle

{

pos2=180;

}

}

}

//*************************************************************/

// lower arm

void dabi()

{

if(y2&gt;1000) // if push the left joystick upward

{

pos3=pos3-1;

myservo3.write(pos3); // the lower arm will stretch out

delay(5);

if(pos3&lt;35) // limit the stretched angle

{

pos3=35;

}

}

if(y2&lt;50) // if push the left joystick downward

{

pos3=pos3+1;

myservo3.write(pos3); // the lower arm will draw back

delay(5);

if(pos3&gt;180) // limit the retracted angle

{

pos3=180;

}

}

}
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Stack the shield onto V4.0, wire them up, upload the code, plug in power and press the key Z1 of right Joystick to save the angle value of 4 servos control and press the key Z2 of left Joystick to operate a servo posture saved in the variable.</p>
<p><strong>Memorize Multiple Postures</strong></p>
<p><strong>Description:</strong></p>
<p>In the previous section, we have set the angle of 4 servos to make the robot arm remember and operate a posture. To extend the experiment, next make it remember several postures, at most 10 (you can set it in the code), then make 4DOF robot arm continually operate the posture in memory. That is, make robot arm memorize a group of actions, and you can set the memorizing speed in the code.</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="image-20230411083310558" src="_images/image-20230411083310558.png" /></p>
<p><img alt="image-20230411083322047" src="_images/image-20230411083322047.png" /></p>
<p><strong>Test Code 6:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Servo.h&gt;</span><span class="c1">  // add the servo libraries</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo1</span><span class="p">;</span><span class="w">  </span><span class="c1">// create servo object to control a servo</span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo2</span><span class="p">;</span><span class="w"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo3</span><span class="p">;</span><span class="w"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo4</span><span class="p">;</span><span class="w">  </span>

<span class="kt">int</span><span class="w"> </span><span class="n">pos1</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">pos2</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="n">pos3</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">pos4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">//  define the variable of 4 servo angle and assign the initial value( that is the boot posture angle value)</span>

<span class="w"> </span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">right_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A2</span><span class="p">;</span><span class="w"> </span><span class="c1">//  define the right X pin to A2  </span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">right_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A5</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the right Y pin to A5 </span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">right_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the right key pin to 7（that is Z value）</span>

<span class="w"> </span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left_X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A3</span><span class="p">;</span><span class="w"> </span><span class="c1">//  define the left X pin to A3</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left_Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A4</span><span class="p">;</span><span class="w">  </span><span class="c1">//  define the left Y pin to A4</span>

<span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">left_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the left key pin to 8（that is Z value） </span>

<span class="w"> </span>

<span class="kt">int</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">;</span><span class="w">  </span><span class="c1">//define the variable, used to save the joystick value.</span>

<span class="kt">int</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="n">s3</span><span class="p">,</span><span class="n">s4</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">jiyi1</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w">  </span><span class="c1">// define 4 array, separately used to save the angle of four servo.</span>

<span class="kt">int</span><span class="w"> </span><span class="n">jiyi2</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w">  </span><span class="c1">//（array length is 10，namely can save angle data of 0~10 servo ）</span>

<span class="kt">int</span><span class="w"> </span><span class="n">jiyi3</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w">  </span><span class="c1">// if need to save more data, just change the number 10 to be more larger number.</span>

<span class="kt">int</span><span class="w"> </span><span class="n">jiyi4</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// for loop</span>

<span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// save the last value of i</span>

<span class="w"> </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"> </span>

<span class="p">{</span><span class="w"></span>

<span class="w"> </span><span class="c1">// boot posture</span>

<span class="w"> </span><span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w">  </span>

<span class="w"> </span><span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="w"> </span><span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="w"> </span><span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="w"> </span><span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="w"> </span><span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span>

<span class="w"> </span>

<span class="w"> </span><span class="n">pinMode</span><span class="p">(</span><span class="n">right_key</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span><span class="w">  </span><span class="c1">// set the right/left key to INPUT</span>

<span class="w"> </span><span class="n">pinMode</span><span class="p">(</span><span class="n">left_key</span><span class="p">,</span><span class="w"> </span><span class="n">INPUT</span><span class="p">);</span><span class="w"></span>

<span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"> </span><span class="c1">//  set baud rate to 9600</span>

<span class="p">}</span><span class="w"></span>

<span class="w"> </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"> </span>

<span class="p">{</span><span class="w"></span>

<span class="w"> </span><span class="n">myservo1</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span><span class="w">  </span><span class="c1">// set the control pin of servo 1 to A1</span>

<span class="w"> </span><span class="n">myservo2</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w">  </span><span class="c1">// set the control pin of servo 2 to A0</span>

<span class="w"> </span><span class="n">myservo3</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span><span class="w">  </span><span class="c1">// set the control pin of servo 3 to D6</span>

<span class="w"> </span><span class="n">myservo4</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span><span class="w">  </span><span class="c1">// set the control pin of servo 4 to D9</span>

<span class="w"> </span>

<span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">right_X</span><span class="p">);</span><span class="w"> </span><span class="c1">// read the right X value </span>

<span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">right_Y</span><span class="p">);</span><span class="w">  </span><span class="c1">// read the right Y value  </span>

<span class="w"> </span><span class="n">z1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digitalRead</span><span class="p">(</span><span class="n">right_key</span><span class="p">);</span><span class="w">  </span><span class="c1">// read the right Z value  </span>

<span class="w"> </span>

<span class="w"> </span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">left_X</span><span class="p">);</span><span class="w">  </span><span class="c1">// read the left X value  </span>

<span class="w"> </span><span class="n">y2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">left_Y</span><span class="p">);</span><span class="w">  </span><span class="c1">// read the left Y value </span>

<span class="w"> </span><span class="n">z2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">digitalRead</span><span class="p">(</span><span class="n">left_key</span><span class="p">);</span><span class="w">  </span><span class="c1">// read the left Z value </span>

<span class="w"> </span><span class="c1">//delay(5);  // reduce the speed overall </span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">z1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// if the right joystick key is pressed </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">  </span><span class="c1">// delay for eliminating shake </span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">z1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// judge again if the right key is pressed</span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">s1</span><span class="o">=</span><span class="n">myservo1</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w">   </span><span class="c1">// read the angle value of each servo  </span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">s2</span><span class="o">=</span><span class="n">myservo2</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">s3</span><span class="o">=</span><span class="n">myservo3</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">s3</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">s4</span><span class="o">=</span><span class="n">myservo4</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">s4</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span>

<span class="w">   </span><span class="n">jiyi1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">s1</span><span class="p">;</span><span class="w">  </span><span class="c1">// Save the read servo value to the array sequentially</span>

<span class="w">   </span><span class="n">jiyi2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">s2</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">jiyi3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">s3</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">jiyi4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">s4</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">i</span><span class="o">++</span><span class="p">;</span><span class="w">   </span><span class="c1">//i value plus 1</span>

<span class="w">   </span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">;</span><span class="w">   </span><span class="c1">// assign the last value of i to j</span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">  </span><span class="c1">// on the serial monitor, print out the value i</span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">z2</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// if the left joystick key is pressed </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">z2</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// judge again if the left key is pressed </span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// assign i to 0，prepare for the next memory</span>

<span class="w">   </span><span class="n">pos1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myservo1</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w">   </span><span class="c1">// memorize the angle value of 4 servo posture</span>

<span class="w">   </span><span class="n">pos2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myservo2</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">pos3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myservo3</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>

<span class="w">   </span><span class="n">pos4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myservo4</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"></span>

<span class="w"> </span>

<span class="w">   </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">j</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w">  </span><span class="c1">// loop for j times, perform all actions saved.</span>

<span class="w">   </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pos1</span><span class="o">&lt;</span><span class="n">jiyi1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w">   </span><span class="c1">// if the current servo 1 angle is less than the value stored in array 1.</span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos1</span><span class="o">&lt;</span><span class="n">jiyi1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w">  </span><span class="c1">//while loop, make servo turn to the position of value stored in the array.</span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w">  </span><span class="c1">// servo 1 performs the action</span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">// delay 5ms，controlling the servo rotating speed</span>

<span class="w">      </span><span class="n">pos1</span><span class="o">++</span><span class="p">;</span><span class="w">  </span><span class="c1">//pos1 plus 1</span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="w">   </span><span class="c1">// if the current servo 1 angle is greater than the value stored in array 1.</span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos1</span><span class="o">&gt;</span><span class="n">jiyi1</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w">   </span><span class="c1">//while loop, make servo turn to the position of value stored in the array.</span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w">  </span><span class="c1">// servo 1 performs the action</span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">   </span><span class="c1">//delay 5ms，controlling the servo rotating speed</span>

<span class="w">      </span><span class="n">pos1</span><span class="o">--</span><span class="p">;</span><span class="w">   </span><span class="c1">//pos1 subtracts 1</span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="c1">//***************************************************************</span>

<span class="w"> </span><span class="c1">//the explanation is the same as the previous servo </span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pos2</span><span class="o">&lt;</span><span class="n">jiyi2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos2</span><span class="o">&lt;</span><span class="n">jiyi2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">pos2</span><span class="o">++</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos2</span><span class="o">&gt;</span><span class="n">jiyi2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">pos2</span><span class="o">--</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="c1">//***************************************************************</span>

<span class="w"> </span><span class="c1">// the explanation is the same as the previous servo  </span>

<span class="w"> </span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pos3</span><span class="o">&lt;</span><span class="n">jiyi3</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos3</span><span class="o">&lt;</span><span class="n">jiyi3</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">pos3</span><span class="o">++</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos3</span><span class="o">&gt;</span><span class="n">jiyi3</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">pos3</span><span class="o">--</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="c1">//***************************************************************</span>

<span class="w"> </span><span class="c1">//the explanation is the same as the previous servo </span>

<span class="w"> </span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">pos4</span><span class="o">&lt;</span><span class="n">jiyi4</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos4</span><span class="o">&lt;</span><span class="n">jiyi4</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">pos4</span><span class="o">++</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="w"></span>

<span class="w">    </span><span class="p">{</span><span class="w"></span>

<span class="w">     </span><span class="k">while</span><span class="p">(</span><span class="n">pos4</span><span class="o">&gt;</span><span class="n">jiyi4</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="w"></span>

<span class="w">     </span><span class="p">{</span><span class="w"></span>

<span class="w">      </span><span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">      </span><span class="n">pos4</span><span class="o">--</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="c1">//Serial.println(pos1);</span>

<span class="w">     </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span>

<span class="w"> </span><span class="c1">//claw</span>

<span class="w"> </span><span class="n">zhuazi</span><span class="p">();</span><span class="w"></span>

<span class="w"> </span><span class="c1">//turn</span>

<span class="w"> </span><span class="n">zhuandong</span><span class="p">();</span><span class="w"></span>

<span class="w"> </span><span class="c1">//upper arm </span>

<span class="w"> </span><span class="n">xiaobi</span><span class="p">();</span><span class="w"></span>

<span class="w"> </span><span class="c1">// lower arm </span>

<span class="w"> </span><span class="n">dabi</span><span class="p">();</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="w"> </span>

<span class="w"> </span>

<span class="c1">//claw</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">zhuazi</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="c1">//claw</span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">x2</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="c1">// if push the left joystick to the right </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos4</span><span class="o">=</span><span class="n">pos4</span><span class="mi">-2</span><span class="p">;</span><span class="w">  </span><span class="c1">// angle of servo 4, subtract 2 (change the value you subtract, thus change the closed speed of claw)</span>

<span class="w">   </span><span class="c1">//Serial.println(pos4);</span>

<span class="w">   </span><span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w">  </span><span class="c1">// servo 4 operates the motion and claw is gradually closed. </span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">pos4</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="c1">// if pos4 value subtracts to 2, the claw in 37 degrees we have tested is closed.）  </span>

<span class="w">   </span><span class="p">{</span><span class="w">       </span><span class="c1">//（should change the value based on the fact）</span>

<span class="w">    </span><span class="n">pos4</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="w">  </span><span class="c1">// stop subtraction when reduce to 2 </span>

<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">x2</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="c1">//// if push the left joystick to the left</span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos4</span><span class="o">=</span><span class="n">pos4</span><span class="o">+</span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="c1">// current angle of servo 4 plus 8（change the value you plus, thus change the open speed of claw）</span>

<span class="w">   </span><span class="c1">//Serial.println(pos4);</span>

<span class="w">   </span><span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"> </span><span class="c1">//  servo 4 operates the action, claw gradually opens.</span>

<span class="w">   </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">pos4</span><span class="o">&gt;</span><span class="mi">90</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the largest angle opened</span>

<span class="w">   </span><span class="p">{</span><span class="w"></span>

<span class="w">    </span><span class="n">pos4</span><span class="o">=</span><span class="mi">90</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">//******************************************************</span>

<span class="w"> </span><span class="c1">// turn </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">zhuandong</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">x1</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">)</span><span class="w">  </span><span class="c1">// if push the right joystick to the right </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">pos1</span><span class="o">=</span><span class="n">pos1</span><span class="mi">-1</span><span class="p">;</span><span class="w">  </span><span class="c1">//pos1 subtracts 1</span>

<span class="w">  </span><span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w">  </span><span class="c1">// servo 1 operates the motion and robot arm turns right </span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pos1</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the angle when turn right  </span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">x1</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span><span class="w">  </span><span class="c1">// if push the right joystick to the left </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">pos1</span><span class="o">=</span><span class="n">pos1</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">//pos1 plus 1</span>

<span class="w">  </span><span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w">  </span><span class="c1">// robot arm turns left </span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pos1</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the angle when turn left </span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos1</span><span class="o">=</span><span class="mi">180</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="w"> </span>

<span class="c1">//************************************************</span>

<span class="c1">// upper arm </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">xiaobi</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">y1</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="c1">// if push the right joystick upward </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">pos2</span><span class="o">=</span><span class="n">pos2</span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"> </span><span class="c1">// the upper arm will lift </span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pos2</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the lifting angle </span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">y1</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">)</span><span class="w">  </span><span class="c1">// if push the right joystick downward</span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">pos2</span><span class="o">=</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w">  </span>

<span class="w">  </span><span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w">  </span><span class="c1">// the upper arm will go down </span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pos2</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the declining angle </span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos2</span><span class="o">=</span><span class="mi">180</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="w"> </span>

<span class="c1">//*************************************************************/</span>

<span class="c1">// lower arm </span>

<span class="kt">void</span><span class="w"> </span><span class="nf">dabi</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">y2</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span><span class="w">  </span><span class="c1">// if push the left joystick upward</span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">pos3</span><span class="o">=</span><span class="n">pos3</span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w">  </span><span class="c1">// the lower arm will stretch out </span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pos3</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the stretched angle</span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos3</span><span class="o">=</span><span class="mi">35</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span>

<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">y2</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">)</span><span class="w">  </span><span class="c1">// if push the left joystick downward </span>

<span class="w"> </span><span class="p">{</span><span class="w"></span>

<span class="w">  </span><span class="n">pos3</span><span class="o">=</span><span class="n">pos3</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w">  </span><span class="c1">// the lower arm will draw back </span>

<span class="w">  </span><span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="p">(</span><span class="n">pos3</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span><span class="w">  </span><span class="c1">// limit the retracted angle</span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>

<span class="w">   </span><span class="n">pos3</span><span class="o">=</span><span class="mi">180</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="p">}</span><span class="w">  </span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Wire it up, stack the shield onto V4.0, upload the code. Powered on, press the key Z1 of right Joystick to save the angle value of 4 servos. Press down the key Z1 to memorize different postures, at most 10 postures in the code. If need to memorize more postures, you can set it in the code. When memorizing successfully, press down the key Z2 of left Joystick to make the robot arm carry out several postures stored successively.</p>
<p>Move the thumbsticks and press the button of right thumbstick, then move them and press the right button again. That indicates that actions of the arm are memorized. Next, you can press the left button to perform actions saved.</p>
<p><strong>Memorize Several Postures And Loop</strong></p>
<p><strong>Description:</strong></p>
<p>In the previous section, we have introduced how to make 4DOF robot arm to memorize and perform a group of posture. Furthermore, let’s extend one more loop function. When the robot arm performs all the memorized actions, it will not
stop, and continue to repeat those actions.</p>
<p>In the following experiment, press the key Z1, 4DOF robot arm will exit the looping action. Press the key Z1 again, start to memorize the posture, after that, press the key Z2 to loop the memorized actions.</p>
<p><strong>Hookup Guide:</strong></p>
<p><img alt="" src="_images/276c6ebb45ee99fc3325c6c6d2b0df75.png" /><img alt="" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code 7:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>#include &lt;Servo.h&gt; // add the servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo angle
and assign the initial value( that is the boot posture angle value)

const int right_X = A2; // define the right X pin to A2

const int right_Y = A5; // define the right Y pin to A5

const int right_key = 7; // define the right key pin to 7（that is Z value）

const int left_X = A3; //define the left X pin to A3

const int left_Y = A4; // define the left Y pin to A4

const int left_key = 8; // define the left key pin to 8（that is Z value）

int x1,y1,z1; // define the variable, used to save the joystick value.

int x2,y2,z2;

int s1,s2,s3,s4;

int jiyi1[20]; //define 4 array, separately used to save the angle of four
servo.

int jiyi2[20]; // （array length is 20，namely can save angle data of 0~20
servo）

int jiyi3[20]; //if need to save more data, just change the number 20 to be more
larger number.

int jiyi4[20];

int i=0; // for loop

int j=0; // save the last value of i

void setup()

{

// boot posture

myservo1.write(pos1); //turn servo 1 to 90 degrees

delay(1000);

myservo2.write(pos2); // turn servo 2 to 90 degrees

myservo3.write(pos3); // turn servo 3 to 120 degrees

myservo4.write(pos4); // turn servo 4 to 35 degrees

delay(1500);

pinMode(right_key, INPUT); // set the right/left key to INOUT

pinMode(left_key, INPUT);

Serial.begin(9600); // set the baud rate to 9600

}

void loop()

{

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); // set the control pin of servo 2 to A0

myservo3.attach(6); //set the control pin of servo 3 to D6

myservo4.attach(9); // set the control pin of servo 4 to D9

x1 = analogRead(right_X); // read the right X value

y1 = analogRead(right_Y); //read the right Y value

z1 = digitalRead(right_key); //read the right Z value

x2 = analogRead(left_X); // read the left X value

y2 = analogRead(left_Y); // read the left Y value

z2 = digitalRead(left_key); // read the left Z value

//delay(5); // delay, used to reduce the joystick value read, that is reduce the
whole speed.

if(z1==1) // if the joystick right key is pressed

{

delay(10); // delay for eliminating shake

if(z1==1) // judge again if the right key is pressed

{

s1=myservo1.read(); // read the angle value of servo 1 and assign it to s1

delay(100);

Serial.println(s1); // print out the angle value of servo 1 on the serial
monitor

s2=myservo2.read(); // read the angle value of servo 2 and assign it to s2

delay(100);

Serial.println(s2);

s3=myservo3.read(); // read the angle value of servo 3 and assign it to s3

delay(100);

Serial.println(s3);

s4=myservo4.read(); // read the angle value of servo 4 and assign it to s4

delay(100);

Serial.println(s4);

jiyi1[i]=s1; // Save the read servo value to the array sequentially

jiyi2[i]=s2;

jiyi3[i]=s3;

jiyi4[i]=s4;

i++; //i plus 1

j=i; // assign the last value of i to j

delay(100); // delay 100ms

Serial.println(i); // print out the value i

}

}

if(z2==1) // if the left joystick key is pressed

{

delay(10); // delay for eliminating shake

if(z2==1) //judge again if the left key is pressed

{

pos1 = myservo1.read(); // memorize the angle value of 4 servo posture

pos2 = myservo2.read();

pos3 = myservo3.read();

pos4 = myservo4.read();

while(z2==1) // loop, make the arm repeat the action.

{

for(int k=1;k&lt;j;k++) //for loop, perform all the stored actions.

{

if(pos1&lt;jiyi1[k]) // if the current servo 1 angle is less than the value stored
in array 1.

{

while(pos1&lt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); //servo 1 performs the action

delay(5); //delay 5ms，controlling the servo rotating speed.

pos1++; //pos1 plus 1

//Serial.println(pos1);

}

}

else //if the current servo 1 angle is greater than the value stored in array 1.

{

while(pos1&gt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); //servo 1 performs the action

delay(5); //delay 5ms，controlling the servo rotating speed.

pos1--; //pos1 subtracts 1

//Serial.println(pos1);

}

}

//***************************************************************

//the explanation is the same as the previous servo.

if(pos2&lt;jiyi2[k])

{

while(pos2&lt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2++;

//Serial.println(pos1);

}

}

else

{

while(pos2&gt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2--;

//Serial.println(pos1);

}

}

//*********************************************

//the explanation is the same as the previous servo.

if(pos3&lt;jiyi3[k])

{

while(pos3&lt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3++;

//Serial.println(pos1);

}

}

else

{

while(pos3&gt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3--;

//Serial.println(pos1);

}

}

//*********************************************

//the explanation is the same as the previous servo.

if(pos4&lt;jiyi4[k])

{

while(pos4&lt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4++;

//Serial.println(pos1);

}

}

else

{

while(pos4&gt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4--;

//Serial.println(pos1);

}

}

}

//************************************************************

// for exiting the loop

z1 = digitalRead(right_key); // read the right Z value

if(z1==1) // if the right key is pressed

{

delay(10); //eliminate the shake

if(z1==1) // if the key z1 is pressed

{

pos1=jiyi1[(j-1)]; // assign the last angle value saved in array to pos

pos2=jiyi2[(j-1)]; // for exiting the loop, still access to joystick control.

pos3=jiyi3[(j-1)];

pos4=jiyi4[(j-1)];

i=0; // assign i as 0，prepare for saving the angle value using array

z2=0; // assign z2 as 0，for exiting the while loop

break; //exit the current loop

}

}

//********************************************************

}

}

}

//claw

zhuazi();

//turn

zhuandong();

//upper arm

xiaobi();

//lower arm

dabi();

}

//claw

void zhuazi()

{

//claw

if(x2&lt;50) // if push the left joystick to the right

{

pos4=pos4-2; // angle of servo 4, subtract 2 (change the value you subtract,
thus change the closed speed of claw)

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the motion and claw is gradually
closed.

delay(5);

if(pos4&lt;2) // if pos4 value subtracts to 2, the claw in 37 degrees we have
tested is closed.）

{ //（should change the value based on the fact）

pos4=2; //stop subtraction when reduce to 2

}

}

if(x2&gt;1000) ////if push the left joystick to the left

{

pos4=pos4+8; //current angle of servo 4 plus 8（change the value you plus, thus
change the open speed of claw）

//Serial.println(pos4);

myservo4.write(pos4); // servo 4 operates the action, claw gradually opens.

delay(5);

if(pos4&gt;90) //limit the largest angle opened

{

pos4=90;

}

}

}

//******************************************************

//turn

void zhuandong()

{

if(x1&lt;50) //if push the right joystick to the right

{

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 performs the action, the robot arm turns right.

delay(5);

if(pos1&lt;1) // limit the right turning angle

{

pos1=1;

}

}

if(x1&gt;1000) // if push the right joystick to the left

{

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); //the robot arm turns left.

delay(5);

if(pos1&gt;180) //limit the left turning angle

{

pos1=180;

}

}

}

//**********************************************************/

// upper arm

void xiaobi()

{

if(y1&gt;1000) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the robot arm will lift

delay(5);

if(pos2&lt;0) // limit the lifting angle

{

pos2=0;

}

}

if(y1&lt;50) // if push the right joystick downward

{

pos2=pos2+1;

myservo2.write(pos2); // the robot arm will go down

delay(5);

if(pos2&gt;180) // limit the declining angle

{

pos2=180;

}

}

}

//*************************************************************/

// lower arm

void dabi()

{

if(y2&gt;1000) // if push the left joystick upward

{

pos3=pos3-1;

myservo3.write(pos3); // the lower arm will stretch out

delay(5);

if(pos3&lt;35) // limit the stretched angle

{

pos3=35;

}

}

if(y2&lt;50) // if push the right joystick downward

{

pos3=pos3+1;

myservo3.write(pos3); // the lower arm will draw back

delay(5);

if(pos3&gt;180) // limit the retraction angle

{

pos3=180;

}

}

}
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Wire it up, stack the shield onto V4.0, upload the code. Powered on, press the key Z1 of right Joystick to save the angle value of 4 servos. Press down the key Z1 to memorize different postures, at most 10 postures in the code. If need to memorize more postures, can set it in the code.</p>
<p>When memorizing successfully, press down the key Z2 of left Joystick to make the robot arm carry out several postures stored successively, looping.</p>
<p>Long press the key Z1, 4DOF robot arm will exit the looping action. Press the key Z1 again, start to memorize the posture, after that, press the key Z2 to loop the memorized actions.</p>
<p>Move the thumbsticks and press the button of right thumbstick, then move them and press the right button again. That indicates that actions of the arm are memorized. Next, you can press the left button to perform actions saved.</p>
</section>
</section>
<section id="project-4-bt-controlled-robot-arm">
<h2>Project 4: BT-controlled Robot Arm<a class="headerlink" href="#project-4-bt-controlled-robot-arm" title="Permalink to this headline"></a></h2>
<p><strong>Principle of BT Control</strong></p>
<p>Bluetooth technology is a wireless standard technology that can realize short-distance data exchange between fixed equipment, mobile equipment andpersonal area network (UHF radio waves in the ISM band of 2.4-2.485GHz). In the kit, we equip with the BT-24 Bluetooth module. BT-24 Bluetooth module supports Android and IOS system.</p>
<p>In the experiment, we default the BT-24 Bluetooth module as the slave and the mobile phone as the master.We especially design APP to control robotic arm(Android /IOS system).</p>
<p><img alt="" src="_images/cbb807206a90dfa82cf44f053ecf00a7.png" /></p>
<p><strong>Specification</strong></p>
<p>Bluetooth protocol: Bluetooth Specification V5.1 BLE</p>
<p>Working distance: In an open environment, achieve 40m ultra-long distance communication</p>
<p>Operating frequency: 2.4GHz ISM band</p>
<p>Communication interface: UART</p>
<p>Bluetooth certification: in line with FCC CE ROHS REACH certification standards</p>
<p>Serial port parameters: 9600, 8 data bits, 1 stop bit, invalid bit, no flow control</p>
<p>Power: 5V DC</p>
<p>Operating temperature: –10 to +65 degrees Celsius</p>
<p><strong>Bluetooth Control Key Test</strong></p>
<p><strong>Description</strong></p>
<p>Next, we are going to introduce the use method for BT-24 Bluetooth module. To easily use the BT-24 Bluetooth module to control the robot arm, we particularly design the APP control. Shown below.</p>
<p><img alt="" src="_images/8656711f637f02b6db5a045a7ba53b40.png" /></p>
<p>There are 10 control keys on the App. When connect well the HC-06 Bluetooth module to Android phone using our APP, press the control key, Android phone will receive a corresponding value.</p>
<p>When programming, you can set the function for the corresponding value. So in the experiment, we will test each key to get the corresponding value.</p>
<p>Installation Steps for Android system:</p>
<p><strong>APP for Android mobile：</strong></p>
<p>Enter google play，search “keyes arm”.</p>
<p><a class="reference external" href="https://play.google.com/store/apps/details?id=com.keyestudio.keyes_arm_123">https://play.google.com/store/apps/details?id=com.keyestudio.keyes_arm_123</a></p>
<p><strong>Note: Allow APP to access “location” in settings of your cellphone when connecting to Bluetooth module, otherwise, Bluetooth may not be connected.</strong></p>
<p>This are operating steps as below, the interface for Android and ios system is same.</p>
<p><strong>Android System:</strong></p>
<ol class="arabic">
<li><p>Download and install<img alt="" src="_images/fc6d5a39bd8fbe1e52c8077c3dc3405f.png" />，the
interface shown below:</p>
<p><img alt="arm1" src="_images/8656711f637f02b6db5a045a7ba53b40.png" /></p>
</li>
<li><p>Upload code and power on, Led of Bluetooth module blinks. Start Bluetooth and open App to click “CONNECT” to connect.</p>
<p><img alt="IMG_256" src="_images/736c6095b3be37d317074d3d8d3f4508.png" /></p>
</li>
<li><p>Upload code on control board, after power-on, LED blinks on Bluetooth module. Start Bluetooth and open App to click “connect”, Bluetooth is connected.</p>
<p><img alt="IMG_256" src="_images/cf00e6325b0681069b244a6200f7d40a.png" /></p>
</li>
</ol>
<p><strong>For IOS system：</strong></p>
<ol class="arabic">
<li><p>Open App Store</p>
<p><img alt="img_0119" src="_images/eeccf6fd30106842b44464a3dc598f0c.png" /></p>
</li>
<li><p>Search “keyes arm”on APP Store，then click “downlaod”.</p></li>
</ol>
<p><img alt="" src="_images/4264bf3b56f5457c27f06cb7190f20da.jpg" /></p>
<p>Special Note: Remove the Bluetooth module please, when uploading the Test Code. Otherwise, the program will fail to upload. After uploading the Test Code, then connect the Bluetooth and Bluetooth module to pair.</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="图形用户界面 描述已自动生成" src="_images/ad79c37f1d72dff76a1fa08882d07a8a.png" /></p>
<p><strong>Test Code</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the serial baud rate to 9600</span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"> </span><span class="c1">// define a variable, used to receive the value read from Bluetooth.</span>

<span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span><span class="w"> </span><span class="c1">// if receive the value</span>

<span class="p">{</span><span class="w"></span>

<span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"> </span><span class="c1">// assign the value read to val</span>

<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After connecting Bluetooth module, open serial port monitor to set baud rate to</p>
<ol class="arabic simple">
<li><p>Press control keys on App, the serial port prints out the corresponding
control character. As shown below:</p></li>
</ol>
<p><img alt="image-20230411133753534" src="_images/image-20230411133753534.png" /></p>
<p><strong>Test Result:</strong></p>
<p>The functions of control keys:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p></p></th>
<th class="head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><img alt="" src="_images/eb01c27394aeba4b54260e0b7643a755.png" /></p></td>
<td><p>Connect APP to bt-24 Bluetooth module</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><img alt="" src="_images/ed35b9dcb754d77970e03303a1fa730d.png" /></p></td>
<td><p>Turn off Bluetooth</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><img alt="IMG_256" src="_images/eaddefccaaff2e1fa998fd1f92987a07.png" /></p></td>
<td><p>Press to send“F” Release to send“S”</p></td>
<td><p>Left servo goes front Left servo stops motion</p></td>
</tr>
<tr class="row-odd"><td><p><img alt="IMG_256" src="_images/8feca34305f895e7132d57efbe17bf2c.png" /></p></td>
<td><p>Press to send “L” Release to send“S”</p></td>
<td><p>Clamp claw opens Clamp claw stops</p></td>
</tr>
<tr class="row-even"><td><p><img alt="IMG_256" src="_images/a3ee22431db2636e3e12be929679a846.png" /></p></td>
<td><p>Mode 1</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><img alt="IMG_256" src="_images/3dc1c3468739b6a6bf4c9b78ea996e45.png" /></p></td>
<td><p>Press to send “R” Release to send“S”</p></td>
<td><p>Clamp claw closes Clamp claw stops</p></td>
</tr>
<tr class="row-even"><td><p><img alt="IMG_256" src="_images/26050f7479e5e99d2bc4ba708df30244.png" /></p></td>
<td><p>Press to send “B” Release to send“S”</p></td>
<td><p>Left Servo draws back Left Servo stops motion</p></td>
</tr>
<tr class="row-odd"><td><p><img alt="IMG_256" src="_images/c368bf8bd399158f3d5462b26b906d88.png" /></p></td>
<td><p>Press to send “f” Release to send“S”</p></td>
<td><p>Right servo stretches out Right servo stops motion</p></td>
</tr>
<tr class="row-even"><td><p><img alt="IMG_256" src="_images/8a5d3d89ae1e9579720ef4493d99819d.png" /></p></td>
<td><p>Press to send “l” Release to send“S”</p></td>
<td><p>The base servo turns left Base servo stops</p></td>
</tr>
<tr class="row-odd"><td><p><img alt="IMG_256" src="_images/79adde2c1ecbc32df08e2045476d457e.png" /></p></td>
<td><p>Mode 2</p></td>
<td><p>——————</p></td>
</tr>
<tr class="row-even"><td><p><img alt="IMG_256" src="_images/4e7bc01c6a4321a3a004292f0cf8ccb1.png" /></p></td>
<td><p>Press to send “r” Release to send“S”</p></td>
<td><p>Base Servo turns right Base Servo stops</p></td>
</tr>
<tr class="row-odd"><td><p><img alt="IMG_256" src="_images/ff076ef08f6781356de8c95e004df1a5.png" /></p></td>
<td><p>Press to send “b” Release to send“S”</p></td>
<td><p>Right Servo draws back Right Servo stops</p></td>
</tr>
</tbody>
</table>
<p><strong>Bluetooth Controls the Robotic Arm</strong></p>
<p><strong>Description</strong></p>
<p>We introduced the control method of the 4-DOF robot arm and bt-24 Bluetooth module. In this experiment, we’ll control 4DOF robotic arm movement via APP.</p>
<p>Note: After uploading test code successfully, unplug the USB data cable and power up via external power supply and control 4 DOF robot arm movement via APP.</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="" src="_images/ad79c37f1d72dff76a1fa08882d07a8a.png" />
<img alt="" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;Servo.h&gt;</span><span class="c1"> // add the servo libraries</span><span class="cp"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo1</span><span class="p">;</span><span class="w"> </span><span class="c1">// create servo object to control a servo</span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo2</span><span class="p">;</span><span class="w"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo3</span><span class="p">;</span><span class="w"></span>

<span class="n">Servo</span><span class="w"> </span><span class="n">myservo4</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="n">pos1</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="n">pos2</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="n">pos3</span><span class="o">=</span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="n">pos4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// define the variable of 4 servo angle</span>
<span class="n">and</span><span class="w"> </span><span class="n">assign</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">value</span><span class="p">(</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">posture</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="n">val</span><span class="p">;</span><span class="w"></span>

<span class="kt">char</span><span class="w"> </span><span class="n">val2</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="c1">// boot posture</span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the baud rate to 9600</span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A1</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the control pin of servo 1 to A1</span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">A0</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the control pin of servo 2 to A0</span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the control pin of servo 3 to D6</span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span><span class="w"> </span><span class="c1">// set the control pin of servo 4 to D9</span>

<span class="k">if</span><span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span><span class="w"> </span><span class="c1">// if receive the data</span>

<span class="p">{</span><span class="w"></span>

<span class="n">val</span><span class="o">=</span><span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span><span class="w"> </span><span class="c1">// read the received data</span>

<span class="n">val2</span><span class="o">=</span><span class="n">val</span><span class="p">;</span><span class="w"> </span><span class="c1">//Give the value of val to val2</span>

<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>

<span class="k">switch</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;L&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">T_left</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// execute the corresponding function when receive</span>
<span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;R&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">T_right</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">RF</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;b&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">rb</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;F&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">ZK</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;B&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">ZB</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;l&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">LF</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;r&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">lb</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;S&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">servo_stop</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">//stop instruction</span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="k">else</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="k">switch</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span><span class="w"> </span><span class="c1">//When the button is pressed and not released,</span>

<span class="p">{</span><span class="w"> </span><span class="c1">//&quot;else&quot; is executed because Bluetooth does not send characters,</span>

<span class="c1">// and the value of val2 is the value of the previously pressed button,</span>

<span class="c1">//so the command of pressing the button will be repeated</span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;L&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">T_left</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">// execute the corresponding function when receive</span>
<span class="n">the</span><span class="w"> </span><span class="n">value</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;R&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">T_right</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;f&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">RF</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;b&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">rb</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;F&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">ZK</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;B&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">ZB</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;l&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">LF</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;r&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">lb</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"></span>

<span class="k">case</span><span class="w"> </span><span class="sc">&#39;S&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">servo_stop</span><span class="p">();</span><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="c1">//stop instruction</span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">//**************************************************</span>

<span class="c1">// turn left</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">T_left</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos1</span><span class="o">=</span><span class="n">pos1</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos1</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos1</span><span class="o">=</span><span class="mi">180</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">//turn right</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">T_right</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos1</span><span class="o">=</span><span class="n">pos1</span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos1</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">//********************************************</span>

<span class="c1">//open the claw</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">ZK</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos4</span><span class="o">=</span><span class="n">pos4</span><span class="mi">-2</span><span class="p">;</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos4</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos4</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">// close the claw</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">ZB</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos4</span><span class="o">=</span><span class="n">pos4</span><span class="o">+</span><span class="mi">8</span><span class="p">;</span><span class="w"></span>

<span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos4</span><span class="o">&gt;</span><span class="mi">108</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos4</span><span class="o">=</span><span class="mi">108</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">//******************************************</span>

<span class="c1">// the upper arm will lift up</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">RF</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos2</span><span class="o">=</span><span class="n">pos2</span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos2</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos2</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">// the upper arm will go down</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">rb</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos2</span><span class="o">=</span><span class="n">pos2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos2</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos2</span><span class="o">=</span><span class="mi">180</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">//***************************************</span>

<span class="c1">// the lower arm will stretch out</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">lb</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos3</span><span class="o">=</span><span class="n">pos3</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos3</span><span class="o">&gt;</span><span class="mi">180</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos3</span><span class="o">=</span><span class="mi">180</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="c1">// the lower arm will draw back</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">LF</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos3</span><span class="o">=</span><span class="n">pos3</span><span class="mi">-1</span><span class="p">;</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="n">pos3</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">)</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">pos3</span><span class="o">=</span><span class="mi">35</span><span class="p">;</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">servo_stop</span><span class="p">()</span><span class="w"></span>

<span class="p">{</span><span class="w"></span>

<span class="n">myservo1</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos1</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo2</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos2</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo3</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos3</span><span class="p">);</span><span class="w"></span>

<span class="n">myservo4</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">pos4</span><span class="p">);</span><span class="w"></span>

<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Upload the code, connect it up and power on, after connecting the Bluetooth APP, press the key to control the robot arm do commanded motions.</p>
</section>
<section id="project-5-ps2-controlled-robot-arm-extension">
<h2>Project 5: PS2-controlled Robot Arm (Extension)<a class="headerlink" href="#project-5-ps2-controlled-robot-arm-extension" title="Permalink to this headline"></a></h2>
<section id="ps2-joypad-key-test">
<h3>5.1 PS2 Joypad Key Test<a class="headerlink" href="#ps2-joypad-key-test" title="Permalink to this headline"></a></h3>
<p><strong>Description:</strong></p>
<p>On the drive shield there is a PS2 Joystick connector, which is easy for you to control the 4DOF robot arm using the PS2 Joypad. But you need to purchase it by yourself because the PS2 Joypad is not included in the kit.</p>
<p>When use the PS2 Joypad to control the robot arm, first need to get the corresponding character of each key on the PS2 Joypad.</p>
<p>So this experiment will help you test the character of each key on the PS2 Joypad.</p>
<p>After connecting the Joypad, should upload the test program on Arduino IDE. But before testing, should place the <strong>PS2X_lib</strong> folder inside the libraries folder of Arduino IDE directory.</p>
<p>Uploading the code, open the serial monitor, connect the PS2 Joypad. When press down the key, you should see the corresponding character on the monitor.</p>
<p><strong>Test Code 10:</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;PS2X_lib.h&gt;</span><span class="c1">  //for v1.6</span><span class="cp"></span>

<span class="n">PS2X</span><span class="w"> </span><span class="n">ps2x</span><span class="p">;</span><span class="w"> </span><span class="c1">// create PS2 Controller Class</span>

<span class="c1">//right now, the library does NOT support hot pluggable controllers, meaning </span>
<span class="c1">//you must always either restart your Arduino after you conect the controller, </span>
<span class="c1">//or call config_gamepad(pins) again after connecting the controller.</span>
<span class="kt">int</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<span class="n">byte</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">byte</span><span class="w"> </span><span class="n">vibrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">setup</span><span class="p">(){</span><span class="w"></span>
<span class="w"> </span><span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">57600</span><span class="p">);</span><span class="w"></span>

<span class="w"> </span><span class="c1">//CHANGES for v1.6 HERE!!! **************PAY ATTENTION*************</span>
<span class="w">  </span>
<span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps2x</span><span class="p">.</span><span class="n">config_gamepad</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w">   </span><span class="c1">//setup pins and settings:  GamePad(clock, command, attention, data, Pressures?, Rumble?) check for error</span>
<span class="w"> </span>
<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"></span>
<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Found Controller, configured successful&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Try out all the buttons, X will vibrate the controller, faster as you press harder;&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;holding L1 or R1 will print out the analog stick values.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Go to www.billporter.info for updates and to report bugs.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;No controller found, check wiring, see readme.txt to enable debug. visit www.billporter.info for troubleshooting tips&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Controller found but not accepting commands. see readme.txt to enable debug. Visit www.billporter.info for troubleshooting tips&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span>
<span class="w">  </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Controller refusing to enter Pressures mode, may not support it. &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">//Serial.print(ps2x.Analog(1), HEX);</span>
<span class="w">   </span>
<span class="w">   </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps2x</span><span class="p">.</span><span class="n">readType</span><span class="p">();</span><span class="w"> </span>
<span class="w">     </span><span class="k">switch</span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="k">case</span><span class="w"> </span><span class="mi">0</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Unknown Controller type&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;DualShock Controller Found&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="o">:</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;GuitarHero Controller Found&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">loop</span><span class="p">(){</span><span class="w"></span>
<span class="w">   </span><span class="cm">/* You must Read Gamepad to get new values</span>
<span class="cm">   Read GamePad and set vibration values</span>
<span class="cm">   ps2x.read_gamepad(small motor on/off, larger motor strenght from 0-255)</span>
<span class="cm">   if you don&#39;t enable the rumble, use ps2x.read_gamepad(); with no values</span>
<span class="cm">   </span>
<span class="cm">   you should call this at least once a second</span>
<span class="cm">   */</span><span class="w"></span>
<span class="w">   </span>
<span class="w">   </span>
<span class="w">   </span>
<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">//skip loop if no controller found</span>
<span class="w">  </span><span class="k">return</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span>
<span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">){</span><span class="w"> </span><span class="c1">//Guitar Hero Controller</span>
<span class="w">   </span>
<span class="w">   </span><span class="n">ps2x</span><span class="p">.</span><span class="n">read_gamepad</span><span class="p">();</span><span class="w">          </span><span class="c1">//read controller </span>
<span class="w">   </span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">GREEN_FRET</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Green Fret Pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">RED_FRET</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Red Fret Pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">YELLOW_FRET</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Yellow Fret Pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">BLUE_FRET</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Blue Fret Pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">ORANGE_FRET</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Orange Fret Pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">     </span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">STAR_POWER</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Star Power Command&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">UP_STRUM</span><span class="p">))</span><span class="w">          </span><span class="c1">//will be TRUE as long as button is pressed</span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Up Strum&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">DOWN_STRUM</span><span class="p">))</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;DOWN Strum&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span>
<span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_START</span><span class="p">))</span><span class="w">                   </span><span class="c1">//will be TRUE as long as button is pressed</span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Start is being held&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_SELECT</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Select is being held&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">ORANGE_FRET</span><span class="p">))</span><span class="w"> </span><span class="c1">// print stick value IF TRUE</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Wammy Bar Position:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">WHAMMY_BAR</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//DualShock Controller</span>
<span class="w">  </span>
<span class="w">    </span><span class="n">ps2x</span><span class="p">.</span><span class="n">read_gamepad</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="n">vibrate</span><span class="p">);</span><span class="w">          </span><span class="c1">//read controller and set large motor to spin at &#39;vibrate&#39; speed</span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_START</span><span class="p">))</span><span class="w">                   </span><span class="c1">//will be TRUE as long as button is pressed</span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Start is being held&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_SELECT</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Select is being held&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span>
<span class="w">         </span>
<span class="w">     </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_PAD_UP</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">         </span><span class="c1">//will be TRUE as long as button is pressed</span>
<span class="w">       </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Up held this hard: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSAB_PAD_UP</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_PAD_RIGHT</span><span class="p">)){</span><span class="w"></span>
<span class="w">       </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Right held this hard: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSAB_PAD_RIGHT</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_PAD_LEFT</span><span class="p">)){</span><span class="w"></span>
<span class="w">       </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LEFT held this hard: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSAB_PAD_LEFT</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_PAD_DOWN</span><span class="p">)){</span><span class="w"></span>
<span class="w">       </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;DOWN held this hard: &quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">     </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSAB_PAD_DOWN</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w">   </span>
<span class="w">  </span>
<span class="w">    </span>
<span class="w">      </span><span class="n">vibrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSAB_BLUE</span><span class="p">);</span><span class="w">        </span><span class="c1">//this will set the large motor vibrate speed based on </span>
<span class="w">                                              </span><span class="c1">//how hard you press the blue (X) button    </span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">NewButtonState</span><span class="p">())</span><span class="w">               </span><span class="c1">//will be TRUE if any button changes state (on to off, or off to on)</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span>
<span class="w">       </span>
<span class="w">         </span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_L3</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;L3 pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_R3</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;R3 pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_L2</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;L2 pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_R2</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;R2 pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_GREEN</span><span class="p">))</span><span class="w"></span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Triangle pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span>
<span class="w">    </span><span class="p">}</span><span class="w">   </span>
<span class="w">         </span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">PSB_RED</span><span class="p">))</span><span class="w">             </span><span class="c1">//will be TRUE if button was JUST pressed</span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Circle just pressed&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">         </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonReleased</span><span class="p">(</span><span class="n">PSB_PINK</span><span class="p">))</span><span class="w">             </span><span class="c1">//will be TRUE if button was JUST released</span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Square just released&quot;</span><span class="p">);</span><span class="w">     </span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">NewButtonState</span><span class="p">(</span><span class="n">PSB_BLUE</span><span class="p">))</span><span class="w">            </span><span class="c1">//will be TRUE if button was JUST pressed OR released</span>
<span class="w">         </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;X just changed&quot;</span><span class="p">);</span><span class="w">    </span>
<span class="w">    </span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_L1</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_R1</span><span class="p">))</span><span class="w"> </span><span class="c1">// print stick values if either is TRUE</span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Stick Values:&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_LY</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"> </span><span class="c1">//Left stick, Y axis. Other options: LX, RY, RX  </span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_LX</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_RY</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"> </span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_RX</span><span class="p">),</span><span class="w"> </span><span class="n">DEC</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span>
<span class="w">    </span>
<span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w"> </span>
<span class="w"> </span>
<span class="w"> </span><span class="n">delay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span><span class="w"></span>
<span class="w">     </span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><strong>Test Result:</strong></p>
<p>Stack the drive shield onto V4.0 and upload the code. Connecting the PS2 Joypad, open the serial monitor and set the baud rate to 57600. When press down the key or push the rocker, you should see the corresponding character showed on the monitor.</p>
</section>
<section id="ps2-joypad-control">
<h3>5.2 PS2 Joypad Control<a class="headerlink" href="#ps2-joypad-control" title="Permalink to this headline"></a></h3>
<p><strong>Description:</strong></p>
<p>In the previous section, we have showed how to use Joystick module to control the robot arm. It is almost the same for you to control the 4DOF robot arm using the PS2 Joypad.</p>
<p><strong>PS2 Joystick Control</strong></p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Right Joystick</strong></p></th>
<th class="head"><p><strong>Robot Arm</strong></p></th>
<th class="head"><p><strong>Left Joystick</strong></p></th>
<th class="head"><p><strong>Robotic Claw</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Push to the right side</p></td>
<td><p>Rotate to right</p></td>
<td><p>Push to the right side</p></td>
<td><p>close</p></td>
</tr>
<tr class="row-odd"><td><p>Push to the left side</p></td>
<td><p>Rotate to left</p></td>
<td><p>Push to the left side</p></td>
<td><p>open</p></td>
</tr>
<tr class="row-even"><td><p>Push forward</p></td>
<td><p>The small arm will lift</p></td>
<td><p>Push forward</p></td>
<td><p>The large arm will move forward</p></td>
</tr>
<tr class="row-odd"><td><p>Push back</p></td>
<td><p>The small arm will lower</p></td>
<td><p>Push back</p></td>
<td><p>The large arm will move back</p></td>
</tr>
</tbody>
</table>
<p><strong>Connection Diagram</strong> <img alt="图示, 示意图描述已自动生成" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>#include &lt;PS2X_lib.h&gt;

PS2X ps2x; // create PS2 Controller Class

//right now, the library does NOT support hot pluggable controllers, meaning

//you must always either restart your Arduino after you connect the controller,

//or call config_gamepad(pins) again after connecting the controller.

int error = 0;

byte vibrate = 0;

#include &lt;Servo.h&gt; // add the servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo angle
and assign the initial value( that is the boot posture angle value)

void setup(){

Serial.begin(57600);

// boot posture

myservo1.write(pos1);

delay(1000);

myservo2.write(pos2);

myservo3.write(pos3);

myservo4.write(pos4);

delay(1500);

error = ps2x.config_gamepad(13,11,10,12); //setup GamePad(clock, command,
attention, data) pins, check for error

if(error == 0){

Serial.println(&quot;Found Controller, configured successful&quot;);

Serial.println(&quot;Try out all the buttons, X will vibrate the controller, faster
as you press harder;&quot;);

Serial.println(&quot;holding L1 or R1 will print out the analog stick values.&quot;);

Serial.println(&quot;Go to www.billporter.info for updates and to report bugs.&quot;);

}

else if(error == 1)

Serial.println(&quot;No controller found, check wiring, see readme.txt to enable
debug. visit www.billporter.info for troubleshooting tips&quot;);

else if(error == 2)

Serial.println(&quot;Controller found but not accepting commands. see readme.txt to
enable debug. Visit www.billporter.info for troubleshooting tips&quot;);

//Serial.print(ps2x.Analog(1), HEX);

ps2x.enableRumble(); //enable rumble vibration motors

ps2x.enablePressures(); //enable reading the pressure values from the buttons.

}

void loop(){

/* You must Read Gamepad to get new values

Read GamePad and set vibration values

ps2x.read_gamepad(small motor on/off, larger motor strenght from 0-255)

if you don&#39;t enable the rumble, use ps2x.read_gamepad(); with no values

you should call this at least once a second

*/

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); // set the control pin of servo 2 to A0

myservo3.attach(6); // set the control pin of servo 3 to D6

myservo4.attach(9); // set the control pin of servo 4 to D9

if(error != 0)

return;

ps2x.read_gamepad(false, vibrate); //read controller and set large motor to spin
at &#39;vibrate&#39; speed

if(ps2x.Button(PSB_START)) //will be TRUE as long as button is pressed

Serial.println(&quot;Start is being held&quot;);

if(ps2x.Button(PSB_SELECT))

Serial.println(&quot;Select is being held&quot;);

if(ps2x.Button(PSB_PAD_UP)) { //will be TRUE as long as button is pressed

Serial.print(&quot;Up held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_UP), DEC);

}

if(ps2x.Button(PSB_PAD_RIGHT)){

Serial.print(&quot;Right held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_RIGHT), DEC);

}

if(ps2x.Button(PSB_PAD_LEFT)){

Serial.print(&quot;LEFT held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_LEFT), DEC);

}

if(ps2x.Button(PSB_PAD_DOWN)){

Serial.print(&quot;DOWN held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_DOWN), DEC);

}

vibrate = ps2x.Analog(PSAB_BLUE); //this will set the large motor vibrate speed
based on

//how hard you press the blue (X) button

if (ps2x.NewButtonState()) //will be TRUE if any button changes state (on to
off, or off to on)

{

if(ps2x.Button(PSB_R3))

Serial.println(&quot;R3 pressed&quot;);

if(ps2x.Button(PSB_L3))

Serial.println(&quot;L3 pressed&quot;);

if(ps2x.Button(PSB_L2))

Serial.println(&quot;L2 pressed&quot;);

if(ps2x.Button(PSB_R2))

Serial.println(&quot;R2 pressed&quot;);

if(ps2x.Button(PSB_GREEN))

Serial.println(&quot;Triangle pressed&quot;);

}

if(ps2x.ButtonPressed(PSB_RED)) //will be TRUE if button was JUST pressed

Serial.println(&quot;Circle just pressed&quot;);

if(ps2x.ButtonReleased(PSB_PINK)) //will be TRUE if button was JUST released

Serial.println(&quot;Square just released&quot;);

if(ps2x.NewButtonState(PSB_BLUE)) //will be TRUE if button was JUST pressed OR
released

Serial.println(&quot;X just changed&quot;);

//rotate

zhuandong();

//claw

zhuazi();

//upper arm

dabi();

//forearm

xiaobi();

if(ps2x.Button(PSB_L1) || ps2x.Button(PSB_R1)) // print stick values if either
is TRUE

{

Serial.print(&quot;Stick Values:&quot;);

Serial.print(ps2x.Analog(PSS_LY), DEC); //Left stick, Y axis. Other options: LX,
RY, RX

Serial.print(&quot;,&quot;);

Serial.print(ps2x.Analog(PSS_LX), DEC);

Serial.print(&quot;,&quot;);

Serial.print(ps2x.Analog(PSS_RY), DEC);

Serial.print(&quot;,&quot;);

Serial.println(ps2x.Analog(PSS_RX), DEC);

}

delay(5);

}

//********************************************************************

// turn

void zhuandong()

{

//turn right

if(ps2x.Analog (PSS_RX) &gt; 200) // if push the right joystick to the right

{

//Serial.println(ps2x.Analog(PSS_RX), DEC);

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 executes the action, the arm will turn right.

// delay(5);

if(pos1&lt;1) // limit the right turning angle

{

pos1=1;

}

}

// turn left

if(ps2x.Analog (PSS_RX) &lt; 50) // if push the right joystick to the left

{

//Serial.println(ps2x.Analog(PSS_RX), DEC);

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); // the arm turns left

// delay(5);

if(pos1&gt;180) // limit the left turning angle

{

pos1=180;

}

}

}

//**********************************************************************

// upper arm

void xiaobi()

{

//upper arm front

if(ps2x.Analog(PSS_RY)&lt;50) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the upper arm will lift

delay(5);

if(pos2&lt;0) // limit the lifting angle

{

pos2=0;

}

}

//upper arm back

if(ps2x.Analog(PSS_RY)&gt;200) // if push the right joystick downward

{

pos2=pos2+1;

myservo2.write(pos2); // the upper arm will go down

delay(5);

if(pos2&gt;180) // limit the declining angle

{

pos2=180;

}

}

}

//***************************************************************

void zhuazi()

{

// close the claw

if(ps2x.Analog(PSS_LX)&gt;220) // if push the left joystick to the right

{

pos4=pos4-1;

Serial.println(pos4);

myservo4.write(pos4); // servo 4 carries out the action and the claw is
gradually closed.

delay(5);

if(pos4&lt;0) // if pos4 value subtracts to 37, the claw in 37 degrees we have
tested is closed.）

{

pos4=0;

}

}

// open the claw

if(ps2x.Analog(PSS_LX)&lt;10) // if push the left joystick to the left

{

pos4=pos4+8;

Serial.println(pos4);

myservo4.write(pos4); // servo 4 carries out the action and the claw is
gradually opened

delay(5);

if(pos4&gt;108) // limit the maximum opening angle

{

pos4=108;

}

}

}

//*********************************************************

void dabi()

{

// lower arm front

if(ps2x.Analog(PSS_LY)&gt;200) // if push the left joystick upward

{

pos3=pos3+1;

myservo3.write(pos3); // the lower arm will stretch out

delay(5);

if(pos3&gt;180) // limit the stretched angle

{

pos3=180;

}

}

if(ps2x.Analog(PSS_LY)&lt;10) //if push the left joystick downward

{

pos3=pos3-1;

myservo3.write(pos3); // the lower arm will draw back

delay(5);

if(pos3&lt;35) // limit the retracted angle

{

pos3=35;

}

}

}
</pre></div>
</div>
<p><strong>Test Result</strong></p>
<p>Control the robotic arm with PS2 joypad.</p>
</section>
<section id="ps2-controlling-posture-memory">
<h3>5.3 PS2 Controlling Posture Memory<a class="headerlink" href="#ps2-controlling-posture-memory" title="Permalink to this headline"></a></h3>
<p><strong>Description</strong></p>
<p>In the previous experiment, we have showed how to use Joystick module to memorize several postures. Now we replace the joystick module with PS2 Joypad. Press the Z1 button to memorize the postures of the arm. If you want to memorize more, you can set in the code. After that, press the Z2 button to perform the saved actions of the arm</p>
<p><strong>Connection Diagram</strong></p>
<p><img alt="图示, 示意图 描述已自动生成" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code12</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>#include &lt;PS2X_lib.h&gt;

#include &lt;Servo.h&gt; // add the servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo angle
and assign the initial value( that is the boot posture angle value)

PS2X ps2x; // create PS2 Controller Class

//right now, the library does NOT support hot pluggable controllers, meaning

//you must always either restart your Arduino after you conect the controller,

//or call config_gamepad(pins) again after connecting the controller.

int error = 0;

byte vibrate = 0;

int s1,s2,s3,s4;

int jiyi1[20]; // define four array, separately used to save the angle of 4
servos.

int jiyi2[20];

int jiyi3[20];

int jiyi4[20];

int i=0;

int j=0;

void setup()

{

Serial.begin(57600);

// boot posture

myservo1.write(pos1);

delay(1000);

myservo2.write(pos2);

myservo3.write(pos3);

myservo4.write(pos4);

delay(1500);

error = ps2x.config_gamepad(13,11,10,12); //setup GamePad(clock, command,
attention, data) pins, check for error

if(error == 0){

Serial.println(&quot;Found Controller, configured successful&quot;);

Serial.println(&quot;Try out all the buttons, X will vibrate the controller, faster
as you press harder;&quot;);

Serial.println(&quot;holding L1 or R1 will print out the analog stick values.&quot;);

Serial.println(&quot;Go to www.billporter.info for updates and to report bugs.&quot;);

}

else if(error == 1)

Serial.println(&quot;No controller found, check wiring, see readme.txt to enable
debug. visit www.billporter.info for troubleshooting tips&quot;);

else if(error == 2)

Serial.println(&quot;Controller found but not accepting commands. see readme.txt to
enable debug. Visit www.billporter.info for troubleshooting tips&quot;);

//Serial.print(ps2x.Analog(1), HEX);

ps2x.enableRumble(); //enable rumble vibration motors

ps2x.enablePressures(); //enable reading the pressure values from the buttons.

}

void loop()

{

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); // set the control pin of servo 2 to A0

myservo3.attach(6); // set the control pin of servo 3 to D6

myservo4.attach(9); // set the control pin of servo 4 to D9

if(error != 0)

return;

ps2x.read_gamepad(false, vibrate); //read controller and set large motor to spin
at &#39;vibrate&#39; speed

if(ps2x.Button(PSB_START)) //will be TRUE as long as button is pressed

Serial.println(&quot;Start is being held&quot;);

if(ps2x.Button(PSB_SELECT))

Serial.println(&quot;Select is being held&quot;);

if(ps2x.Button(PSB_PAD_UP)) { //will be TRUE as long as button is pressed

Serial.print(&quot;Up held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_UP), DEC);

}

if(ps2x.Button(PSB_PAD_RIGHT)){

Serial.print(&quot;Right held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_RIGHT), DEC);

}

if(ps2x.Button(PSB_PAD_LEFT)){

Serial.print(&quot;LEFT held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_LEFT), DEC);

}

if(ps2x.Button(PSB_PAD_DOWN)){

Serial.print(&quot;DOWN held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_DOWN), DEC);

}

vibrate = ps2x.Analog(PSAB_BLUE); //this will set the large motor vibrate speed
based on

//how hard you press the blue (X) button

if (ps2x.NewButtonState()) //will be TRUE if any button changes state (on to
off, or off to on)

{

if(ps2x.Button(PSB_R3))

{

//Serial.println(&quot;R3 pressed&quot;);

// record

s1=myservo1.read();

delay(100);

Serial.println(s1);

s2=myservo2.read();

delay(100);

Serial.println(s2);

s3=myservo3.read();

delay(100);

Serial.println(s3);

s4=myservo4.read();

delay(100);

Serial.println(s4);

jiyi1[i]=s1; // save the servo value read in the array sequentially

jiyi2[i]=s2;

jiyi3[i]=s3;

jiyi4[i]=s4;

i++;

j=i;

// delay(100);

Serial.println(i);

}

if(ps2x.Button(PSB_L3))

{

//Serial.println(&quot;L3 pressed&quot;);

i=0;

//执行

pos1 = myservo1.read();

pos2 = myservo2.read();

pos3 = myservo3.read();

pos4 = myservo4.read();

for(int k=0;k&lt;j;k++) //for loop, to execute all the stored actions

{

if(pos1&lt;jiyi1[k]) //if the current servo 1 angle is less than the value stored
in array 1.

{

while(pos1&lt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); // servo 1 executes the action

delay(5); // delay 5ms，controlling the rotating speed of servo

pos1++;

//Serial.println(pos1);

}

}

else //if the current servo 1 angle is greater than the value stored in array 1.

{

while(pos1&gt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); // servo 1 executes the action

delay(5); //delay 5ms，controlling the rotating speed of servo

pos1--;

//Serial.println(pos1);

}

//**********************************************

// the same analysis as the previous servo

if(pos2&lt;jiyi2[k])

{

while(pos2&lt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2++;

//Serial.println(pos1);

}

}

else

{

while(pos2&gt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2--;

//Serial.println(pos1);

}

}

//*****************************************************

//the same analysis

if(pos3&lt;jiyi3[k])

{

while(pos3&lt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3++;

//Serial.println(pos1);

}

}

else

{

while(pos3&gt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3--;

//Serial.println(pos1);

}

}

//*****************************************************

//the same analysis

if(pos4&lt;jiyi4[k])

{

while(pos4&lt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4++;

//Serial.println(pos1);

}

}

else

{

while(pos4&gt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4--;

//Serial.println(pos1);

}

}

}

}

}

if(ps2x.Button(PSB_L2))

Serial.println(&quot;L2 pressed&quot;);

if(ps2x.Button(PSB_R2))

Serial.println(&quot;R2 pressed&quot;);

if(ps2x.Button(PSB_GREEN))

Serial.println(&quot;Triangle pressed&quot;);

}

if(ps2x.ButtonPressed(PSB_RED)) //will be TRUE if button was JUST pressed

Serial.println(&quot;Circle just pressed&quot;);

if(ps2x.ButtonReleased(PSB_PINK)) //will be TRUE if button was JUST released

Serial.println(&quot;Square just released&quot;);

if(ps2x.NewButtonState(PSB_BLUE)) //will be TRUE if button was JUST pressed OR
released

Serial.println(&quot;X just changed&quot;);

// turn

zhuandong();

// claw

zhuazi();

// lower arm

dabi();

// upper arm

xiaobi();

if(ps2x.Button(PSB_L1) || ps2x.Button(PSB_R1)) // print stick values if either
is TRUE

{

Serial.print(&quot;Stick Values:&quot;);

Serial.print(ps2x.Analog(PSS_LY), DEC); //Left stick, Y axis. Other options: LX,
RY, RX

Serial.print(&quot;,&quot;);

Serial.print(ps2x.Analog(PSS_LX), DEC);

Serial.print(&quot;,&quot;);

Serial.print(ps2x.Analog(PSS_RY), DEC);

Serial.print(&quot;,&quot;);

Serial.println(ps2x.Analog(PSS_RX), DEC);

}

delay(5);

}

//********************************************************************

// turn

void zhuandong()

{

//turn right

if(ps2x.Analog (PSS_RX) &gt; 200) // if push the right joystick to the right

{

//Serial.println(ps2x.Analog(PSS_RX), DEC);

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 carries out the action and the arm will turn
right

// delay(5);

if(pos1&lt;1) // limit the right turning angle

{

pos1=1;

}

}

//left-handed rotation

if(ps2x.Analog (PSS_RX) &lt; 50) //if push the right joystick to the left

{

//Serial.println(ps2x.Analog(PSS_RX), DEC);

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); // the arm will turn left

// delay(5);

if(pos1&gt;180) // limit the left turning angle

{

pos1=180;

}

}

}

//**********************************************************************

// upper arm

void xiaobi()

{

//upper arm front

if(ps2x.Analog(PSS_RY)&lt;50) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the upper arm will lift up

delay(5);

if(pos2&lt;0) // limit the lifting angle

{

pos2=0;

}

}

// upper arm back

if(ps2x.Analog(PSS_RY)&gt;200) //if push the right joystick downward

{

pos2=pos2+1;

myservo2.write(pos2); // the upper arm will go down

delay(5);

if(pos2&gt;180) // limit the declining angle

{

pos2=180;

}

}

}

//***************************************************************

void zhuazi()

{

// close the claw

if(ps2x.Analog(PSS_LX)&gt;220) // if push the left joystick to the right

{

pos4=pos4-1;

Serial.println(pos4);

myservo4.write(pos4); // servo 4 carries out the action and the claw is
gradually closed.

delay(5);

if(pos4&lt;0) // if pos4 value reduces to 37（the claw we test in 37degrees is
closed）

{

pos4=0;

}

}

// open the claw

if(ps2x.Analog(PSS_LX)&lt;10) // if push the left joystick to the left

{

pos4=pos4+8;

Serial.println(pos4);

myservo4.write(pos4); // servo 4 carries out the action and the claw is
gradually opened

delay(5);

if(pos4&gt;108) // limit the maximum angle opened

{

pos4=108;

}

}

}

//*********************************************************

void dabi()

{

// lower arm front

if(ps2x.Analog(PSS_LY)&gt;200) // if push the left joystick upward

{

pos3=pos3+1;

myservo3.write(pos3); // the lower arm will stretch out

delay(5);

if(pos3&gt;180) // limit the stretched angle

{

pos3=180;

}

}

if(ps2x.Analog(PSS_LY)&lt;10) // if push the left joystick downward

{

pos3=pos3-1;

myservo3.write(pos3); //the lower arm will retract

delay(5);

if(pos3&lt;35) // limit the retracted angle

{

pos3=35;

}

}

}
</pre></div>
</div>
<p><strong>Test Result</strong></p>
<p>Move the PS2 rocker to control robot arm, press the button of the PS2 rocker to record its posture, and move the joystick again and press the button of the PS2 rocker to memorize the posture. Next, press the left button of the PS2 joypad to perform postures.</p>
</section>
<section id="ps2-controls-posture-memory-and-loop">
<h3>5.4 PS2 Controls Posture Memory and Loop<a class="headerlink" href="#ps2-controls-posture-memory-and-loop" title="Permalink to this headline"></a></h3>
<p><strong>Description:</strong></p>
<p>In the previous experiment, we have showed how to use Joystick module to control the robot arm memorize several postures and loop. Now we replace the Joystick module with the PS2 Joypad. The program is almost the same.</p>
<p>Move the thumbsticks and press the button of the right thumbstick, then move them and press the right button again. That indicates that actions of the arm are memorized. Next, you can press the left button to perform actions saved.</p>
<p><strong>Connection Diagram:</strong></p>
<p><img alt="图示, 示意图 描述已自动生成" src="_images/2e3e92c9a66fa0b26bfba3e200e62391.png" /></p>
<p><strong>Test Code13</strong></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span>#include &lt;PS2X_lib.h&gt;

#include &lt;Servo.h&gt; // add the servo libraries

Servo myservo1; // create servo object to control a servo

Servo myservo2;

Servo myservo3;

Servo myservo4;

int pos1=80, pos2=60, pos3=130, pos4=0; // define the variable of 4 servo angle
and assign the initial value( that is the boot posture angle value)

PS2X ps2x; // create PS2 Controller Class

//right now, the library does NOT support hot pluggable controllers, meaning

//you must always either restart your Arduino after you conect the controller,

//or call config_gamepad(pins) again after connecting the controller.

int error = 0;

byte vibrate = 0;

int s1,s2,s3,s4;

int jiyi1[30]; //define four array, separately used to save the angle of 4
servos.

int jiyi2[30];

int jiyi3[30];

int jiyi4[30];

int i=0;

int j=0,tt=0;

void setup()

{

Serial.begin(57600);

// boot posture

myservo1.write(pos1);

delay(1000);

myservo2.write(pos2);

myservo3.write(pos3);

myservo4.write(pos4);

delay(1500);

error = ps2x.config_gamepad(13,11,10,12); //setup GamePad(clock, command,
attention, data) pins, check for error

if(error == 0){

Serial.println(&quot;Found Controller, configured successful&quot;);

Serial.println(&quot;Try out all the buttons, X will vibrate the controller, faster
as you press harder;&quot;);

Serial.println(&quot;holding L1 or R1 will print out the analog stick values.&quot;);

Serial.println(&quot;Go to www.billporter.info for updates and to report bugs.&quot;);

}

else if(error == 1)

Serial.println(&quot;No controller found, check wiring, see readme.txt to enable
debug. visit www.billporter.info for troubleshooting tips&quot;);

else if(error == 2)

Serial.println(&quot;Controller found but not accepting commands. see readme.txt to
enable debug. Visit www.billporter.info for troubleshooting tips&quot;);

//Serial.print(ps2x.Analog(1), HEX);

ps2x.enableRumble(); //enable rumble vibration motors

ps2x.enablePressures(); //enable reading the pressure values from the buttons.

}

void loop()

{

myservo1.attach(A1); // set the control pin of servo 1 to A1

myservo2.attach(A0); //set the control pin of servo 2 to A0

myservo3.attach(6); //set the control pin of servo 3 to D6

myservo4.attach(9); //set the control pin of servo 4 to D9

if(error != 0)

return;

ps2x.read_gamepad(false, vibrate); //read controller and set large motor to spin
at &#39;vibrate&#39; speed

if(ps2x.Button(PSB_START)) //will be TRUE as long as button is pressed

Serial.println(&quot;Start is being held&quot;);

if(ps2x.Button(PSB_SELECT))

Serial.println(&quot;Select is being held&quot;);

if(ps2x.Button(PSB_PAD_UP)) { //will be TRUE as long as button is pressed

Serial.print(&quot;Up held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_UP), DEC);

}

if(ps2x.Button(PSB_PAD_RIGHT)){

Serial.print(&quot;Right held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_RIGHT), DEC);

}

if(ps2x.Button(PSB_PAD_LEFT)){

Serial.print(&quot;LEFT held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_LEFT), DEC);

}

if(ps2x.Button(PSB_PAD_DOWN)){

Serial.print(&quot;DOWN held this hard: &quot;);

Serial.println(ps2x.Analog(PSAB_PAD_DOWN), DEC);

}

vibrate = ps2x.Analog(PSAB_BLUE); //this will set the large motor vibrate speed
based on

//how hard you press the blue (X) button

if (ps2x.NewButtonState()) //will be TRUE if any button changes state (on to
off, or off to on)

{

if(ps2x.Button(PSB_R3))

{

//Serial.println(&quot;R3 pressed&quot;);

//record

s1=myservo1.read();

delay(100);

Serial.println(s1);

s2=myservo2.read();

delay(100);

Serial.println(s2);

s3=myservo3.read();

delay(100);

Serial.println(s3);

s4=myservo4.read();

delay(100);

Serial.println(s4);

jiyi1[i]=s1; //save the servo value read in the array sequentially

jiyi2[i]=s2;

jiyi3[i]=s3;

jiyi4[i]=s4;

i++;

j=i;

// delay(100);

Serial.println(i);

}

// carry out

if(ps2x.Button(PSB_L3))

{

//Serial.println(&quot;L3 pressed&quot;);

i=0;

tt=1;

pos1 = myservo1.read(); // record the angle value of 4 servo posture

pos2 = myservo2.read();

pos3 = myservo3.read();

pos4 = myservo4.read();

while(tt==1) // repeat the actions

{

for(int k=0;k&lt;j;k++) //for loop, to execute all the stored actions.

{

if(pos1&lt;jiyi1[k]) // if the current servo 1 angle is less than the value stored
in array 1.

{

while(pos1&lt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); //servo 1 executes the action

delay(5); //delay 5ms，controlling the rotating speed of servo.

pos1++;

//Serial.println(pos1);

}

}

else //if the current servo 1 angle is greater than the value stored in array 1.

{

while(pos1&gt;jiyi1[k]) //while loop, make servo turn to the position of value
stored in the array.

{

myservo1.write(pos1); //servo 1 executes the action

delay(5); //delay 5ms，controlling the rotating speed of servo.

pos1--;

//Serial.println(pos1);

}

//**********************************************

// the same analysis as the previous servo

if(pos2&lt;jiyi2[k])

{

while(pos2&lt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2++;

//Serial.println(pos1);

}

}

else

{

while(pos2&gt;jiyi2[k])

{

myservo2.write(pos2);

delay(5);

pos2--;

//Serial.println(pos1);

}

}

//*****************************************************

// the same analysis as the previous servo

if(pos3&lt;jiyi3[k])

{

while(pos3&lt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3++;

//Serial.println(pos1);

}

}

else

{

while(pos3&gt;jiyi3[k])

{

myservo3.write(pos3);

delay(5);

pos3--;

//Serial.println(pos1);

}

}

//*****************************************************

// the same analysis as the previous servo

if(pos4&lt;jiyi4[k])

{

while(pos4&lt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4++;

//Serial.println(pos1);

}

}

else

{

while(pos4&gt;jiyi4[k])

{

myservo4.write(pos4);

delay(5);

pos4--;

//Serial.println(pos1);

}

}

}

}

//*******************************************************

// exit the looping

ps2x.enableRumble(); //enable rumble vibration motors

ps2x.enablePressures();

ps2x.read_gamepad(false, vibrate);

vibrate = ps2x.Analog(PSAB_BLUE);

if (ps2x.NewButtonState()) //will be TRUE if any button changes state (on to
off, or off to on)

{

if(ps2x.Button(PSB_R3))

{

tt=0;

i=0;

break;

}

}

//*********************************************************

}

}

if(ps2x.Button(PSB_L2))

Serial.println(&quot;L2 pressed&quot;);

if(ps2x.Button(PSB_R2))

Serial.println(&quot;R2 pressed&quot;);

if(ps2x.Button(PSB_GREEN))

Serial.println(&quot;Triangle pressed&quot;);

}

if(ps2x.ButtonPressed(PSB_RED)) //will be TRUE if button was JUST pressed

Serial.println(&quot;Circle just pressed&quot;);

if(ps2x.ButtonReleased(PSB_PINK)) //will be TRUE if button was JUST released

Serial.println(&quot;Square just released&quot;);

if(ps2x.NewButtonState(PSB_BLUE)) //will be TRUE if button was JUST pressed OR
released

Serial.println(&quot;X just changed&quot;);

//turn

zhuandong();

//claw

zhuazi();

//lower arm

dabi();

//upper arm

xiaobi();

if(ps2x.Button(PSB_L1) || ps2x.Button(PSB_R1)) // print stick values if either
is TRUE

{

Serial.print(&quot;Stick Values:&quot;);

Serial.print(ps2x.Analog(PSS_LY), DEC); //Left stick, Y axis. Other options: LX,
RY, RX

Serial.print(&quot;,&quot;);

Serial.print(ps2x.Analog(PSS_LX), DEC);

Serial.print(&quot;,&quot;);

Serial.print(ps2x.Analog(PSS_RY), DEC);

Serial.print(&quot;,&quot;);

Serial.println(ps2x.Analog(PSS_RX), DEC);

}

delay(5);

}

//********************************************************************

// turn

void zhuandong()

{

// turn right

if(ps2x.Analog (PSS_RX) &gt; 200) // if push the right joystick to the right

{

//Serial.println(ps2x.Analog(PSS_RX), DEC);

pos1=pos1-1; //pos1 subtracts 1

myservo1.write(pos1); // servo 1 carries out the action, the robot arm turns
right.

// delay(5);

if(pos1&lt;1) // limit the right turning angle

{

pos1=1;

}

}

// turn left

if(ps2x.Analog (PSS_RX) &lt; 50) // if push the right joystick to the left

{

//Serial.println(ps2x.Analog(PSS_RX), DEC);

pos1=pos1+1; //pos1 plus 1

myservo1.write(pos1); // the robot arm turns left

// delay(5);

if(pos1&gt;180) // limit the left turning angle

{

pos1=180;

}

}

}

//**********************************************************************

// the upper arm

void xiaobi()

{

// upper arm front

if(ps2x.Analog(PSS_RY)&lt;50) // if push the right joystick upward

{

pos2=pos2-1;

myservo2.write(pos2); // the upper arm will lift up

delay(5);

if(pos2&lt;0) // limit the lifting angle

{

pos2=0;

}

}

// upper arm back

if(ps2x.Analog(PSS_RY)&gt;200) //if push the right joystick to downward

{

pos2=pos2+1;

myservo2.write(pos2); // the robot arm will go down

delay(5);

if(pos2&gt;180) // limit the declining angle

{

pos2=180;

}

}

}

//***************************************************************

void zhuazi()

{

// close the claw

if(ps2x.Analog(PSS_LX)&gt;220) // if push the left joystick to the right

{

pos4=pos4-1;

Serial.println(pos4);

myservo4.write(pos4); // servo 4 carries out the action and claw is gradually
closed

delay(5);

if(pos4&lt;0) // if pos4 value subtracts to 37, the claw in 37 degrees we have
tested is closed.）

{

pos4=0;

}

}

// open the claw

if(ps2x.Analog(PSS_LX)&lt;10) // if push the left joystick to the left

{

pos4=pos4+8;

Serial.println(pos4);

myservo4.write(pos4); // servo 4 carries out the action and claw is gradually
opened

delay(5);

if(pos4&gt;108) // limit the maximum angle opened

{

pos4=108;

}

}

}

//*********************************************************

void dabi()

{

// lower arm front

if(ps2x.Analog(PSS_LY)&gt;200) // if push the left joystick upward

{

pos3=pos3+1;

myservo3.write(pos3); // the lower arm will stretch out

delay(5);

if(pos3&gt;180) // limit the stretched angle

{

pos3=180;

}

}

if(ps2x.Analog(PSS_LY)&lt;10) // if push the left joystick downward

{

pos3=pos3-1;

myservo3.write(pos3); // the lower arm will draw back

delay(5);

if(pos3&lt;35) // limit the retracted angle

{

pos3=35;

}

}

}
</pre></div>
</div>
<p><strong>Test Result</strong></p>
<p>Operate the PS2 joypad and press the right thumbstick to remember the posture of the robot arm, then press the left thumbstick to perform postures saved. Hold down the right thumbstick to exit the loop of postures.</p>
<p><strong>Test Result:</strong></p>
<p>Stack the shield onto V4.0 and upload the code. Powered on and connected the PS2 Joypad, you can use the PS2 Joypad to control the robot arm memorize several postures, looping.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
       
</footer>
        </div>
      </div>
    </section>
  </div>
  

  
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>

<!-- Mirrored from ks0198x-4dof-robot-mechanical-arm-kit-for-arduino-diy.readthedocs.io/en/latest/KS0198X.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 24 Feb 2024 08:08:21 GMT -->
</html>